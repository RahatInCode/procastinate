<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            color: #37352f;
            line-height: 1.5;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: #f7f6f3;
            border-right: 1px solid #e9e9e7;
            padding: 12px;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 8px 12px;
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: #37352f;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-item {
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item:hover {
            background: #efefed;
        }

        .nav-item.active {
            background: #e3e2e0;
            font-weight: 500;
        }

        .nav-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .month-selector {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e9e9e7;
        }

        .month-selector-title {
            font-size: 11px;
            font-weight: 600;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .month-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 12px;
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            margin-bottom: 8px;
        }

        .month-controls button {
            background: transparent;
            border: none;
            color: #37352f;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 18px;
            line-height: 1;
        }

        .month-controls button:hover {
            background: #efefed;
        }

        .month-name {
            font-size: 14px;
            font-weight: 500;
            color: #37352f;
        }

        /* Main Content */
        .main-content {
            margin-left: 240px;
            padding: 48px 96px;
            max-width: 1600px;
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 0;
                padding: 0;
                overflow: hidden;
            }
            .main-content {
                margin-left: 0;
                padding: 24px;
            }
            .mobile-nav {
                display: block !important;
            }
        }

        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e9e9e7;
            padding: 8px;
            z-index: 100;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            overflow-x: auto;
        }

        .mobile-nav-item {
            padding: 8px 12px;
            font-size: 11px;
            border-radius: 3px;
            cursor: pointer;
            background: transparent;
            border: none;
            color: #37352f;
            white-space: nowrap;
        }

        .mobile-nav-item.active {
            background: #e3e2e0;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 40px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 4px;
            color: #37352f;
        }

        .page-subtitle {
            font-size: 14px;
            color: #9b9a97;
        }

        .today-badge {
            display: inline-block;
            background: #e9e9e7;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            color: #787774;
            margin-top: 8px;
        }

        /* Chart Section */
        .chart-section {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #37352f;
        }

        .chart-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
        }

        .chart-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .stat-dot.completed {
            background: #0f7b6c;
        }

        .stat-dot.failed {
            background: #eb5757;
        }

        .chart-container {
            position: relative;
            height: 200px;
        }

        /* Section */
        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 4px 0;
        }

        .section-icon {
            font-size: 18px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
        }

        /* Academic Tracker */
        .academic-section {
            background: #fefce8;
            border: 1px solid #fde047;
            border-radius: 3px;
            padding: 20px;
            margin-bottom: 32px;
        }

        .academic-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .academic-title {
            font-size: 20px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 4px;
        }

        .academic-subtitle {
            font-size: 13px;
            color: #78716c;
        }

        .academic-badge {
            background: #fde047;
            padding: 4px 12px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            color: #854d0e;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .subject-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 16px;
            transition: all 0.15s;
        }

        .subject-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .subject-name {
            font-size: 15px;
            font-weight: 600;
            color: #37352f;
            flex: 1;
        }

        .year-badge {
            background: #e3e2e0;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            color: #37352f;
        }

        .subject-progress {
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 6px;
            background: #e9e9e7;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #9b9a97;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }

        .chapter-box {
            aspect-ratio: 1;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.15s;
            background: #ffffff;
        }

        .chapter-box:hover {
            background: #f7f6f3;
        }

        .chapter-box.completed {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .subject-meta {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid #e9e9e7;
            font-size: 12px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .meta-label {
            color: #9b9a97;
            font-size: 10px;
            text-transform: uppercase;
        }

        .meta-value {
            color: #37352f;
            font-weight: 600;
        }

        .deadline-warning {
            color: #dc2626;
        }

        .deadline-good {
            color: #059669;
        }

        /* ===== STUDY PLAN STYLES ===== */
        .study-plan-section {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .study-plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .study-plan-header-left h2 {
            font-size: 20px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 2px;
        }

        .study-plan-header-left p {
            font-size: 13px;
            color: #78716c;
        }

        .study-plan-tabs {
            display: flex;
            gap: 4px;
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            padding: 3px;
        }

        .study-plan-tab {
            padding: 6px 14px;
            border: none;
            border-radius: 4px;
            background: transparent;
            font-size: 13px;
            font-weight: 500;
            color: #78716c;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
        }

        .study-plan-tab:hover {
            background: #f7f6f3;
        }

        .study-plan-tab.active {
            background: #16a34a;
            color: #fff;
        }

        /* Subject Selector Row */
        .sp-subject-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .sp-subject-pill {
            padding: 6px 14px;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            color: #37352f;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
            white-space: nowrap;
        }

        .sp-subject-pill:hover {
            border-color: #16a34a;
            background: #f0fdf4;
        }

        .sp-subject-pill.active {
            background: #16a34a;
            color: #fff;
            border-color: #16a34a;
        }

        /* Plan Grid (Gantt-style) */
        .sp-plan-wrapper {
            overflow-x: auto;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            background: #fff;
        }

        .sp-plan-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }

        .sp-plan-table thead th {
            background: #f7f6f3;
            font-size: 11px;
            font-weight: 600;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #e9e9e7;
            white-space: nowrap;
            position: sticky;
            top: 0;
        }

        .sp-plan-table thead th:first-child {
            position: sticky;
            left: 0;
            z-index: 2;
            min-width: 150px;
        }

        .sp-plan-table thead th.sp-month-head {
            text-align: center;
            min-width: 100px;
        }

        .sp-plan-table tbody tr {
            border-bottom: 1px solid #f0f0ee;
            transition: background 0.1s;
        }

        .sp-plan-table tbody tr:last-child {
            border-bottom: none;
        }

        .sp-plan-table tbody tr:hover {
            background: #fafafa;
        }

        .sp-row-label {
            position: sticky;
            left: 0;
            background: #fff;
            z-index: 1;
            padding: 10px 12px;
            font-size: 13px;
            font-weight: 600;
            color: #37352f;
            border-right: 1px solid #e9e9e7;
            white-space: nowrap;
        }

        .sp-plan-table tbody tr:hover .sp-row-label {
            background: #fafafa;
        }

        .sp-cell {
            padding: 8px;
            text-align: center;
            vertical-align: middle;
            border-right: 1px solid #f0f0ee;
            min-width: 100px;
        }

        .sp-cell:last-child {
            border-right: none;
        }

        /* Chapter pills inside cells */
        .sp-chapter-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }

        .sp-chapter-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 26px;
            height: 26px;
            padding: 0 6px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
            cursor: default;
            white-space: nowrap;
        }

        .sp-chapter-pill.done {
            background: #bbdefb;
            color: #1565c0;
            border-color: #90caf9;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .sp-cell-empty {
            color: #bbb;
            font-size: 18px;
        }

        /* Add-chapter btn */
        .sp-add-btn {
            display: inline-flex;
            align-items: center;
            gap: 3px;
            padding: 3px 8px;
            border: 1px dashed #a3a3a3;
            border-radius: 4px;
            background: transparent;
            color: #78716c;
            font-size: 11px;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
            margin-top: 4px;
        }

        .sp-add-btn:hover {
            border-color: #16a34a;
            color: #16a34a;
            background: #f0fdf4;
        }

        /* Time allocation row */
        .sp-time-row .sp-cell {
            background: #fefce8;
        }

        .sp-time-input {
            width: 70px;
            padding: 4px 6px;
            border: 1px solid #e9e9e7;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            color: #37352f;
            font-family: inherit;
            background: #fff;
            transition: border-color 0.15s;
        }

        .sp-time-input:focus {
            outline: none;
            border-color: #16a34a;
            box-shadow: 0 0 0 2px rgba(22,163,74,0.15);
        }

        .sp-time-input::placeholder {
            color: #bbb;
        }

        .sp-time-label {
            font-size: 10px;
            color: #9b9a97;
            margin-top: 2px;
        }

        /* Summary bar */
        .sp-summary-bar {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .sp-summary-card {
            flex: 1;
            min-width: 140px;
            background: #fff;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sp-summary-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .sp-summary-icon.green { background: #dcfce7; }
        .sp-summary-icon.blue  { background: #dbeafe; }
        .sp-summary-icon.amber { background: #fef3c7; }
        .sp-summary-icon.red   { background: #fee2e2; }

        .sp-summary-text .sp-sum-val {
            font-size: 20px;
            font-weight: 700;
            color: #37352f;
            line-height: 1.2;
        }

        .sp-summary-text .sp-sum-label {
            font-size: 11px;
            color: #9b9a97;
        }

        /* Modal overlay */
        .sp-modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            z-index: 500;
            align-items: center;
            justify-content: center;
        }

        .sp-modal-overlay.visible {
            display: flex;
        }

        .sp-modal {
            background: #fff;
            border-radius: 8px;
            width: 420px;
            max-width: 90vw;
            box-shadow: 0 16px 40px rgba(0,0,0,0.15);
            padding: 24px;
            animation: sp-modal-in 0.18s ease;
        }

        @keyframes sp-modal-in {
            from { opacity:0; transform: translateY(12px); }
            to   { opacity:1; transform: translateY(0); }
        }

        .sp-modal h3 {
            font-size: 17px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 4px;
        }

        .sp-modal .sp-modal-sub {
            font-size: 13px;
            color: #9b9a97;
            margin-bottom: 18px;
        }

        .sp-modal label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #78716c;
            margin-bottom: 5px;
            margin-top: 12px;
        }

        .sp-modal select,
        .sp-modal input[type="text"],
        .sp-modal input[type="number"] {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e9e9e7;
            border-radius: 5px;
            font-size: 13px;
            font-family: inherit;
            color: #37352f;
            background: #fff;
            transition: border-color 0.15s;
        }

        .sp-modal select:focus,
        .sp-modal input:focus {
            outline: none;
            border-color: #16a34a;
            box-shadow: 0 0 0 2px rgba(22,163,74,0.12);
        }

        .sp-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 22px;
        }

        .sp-btn-cancel {
            padding: 7px 16px;
            border: 1px solid #e9e9e7;
            border-radius: 5px;
            background: #fff;
            color: #37352f;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
        }

        .sp-btn-cancel:hover { background: #f7f6f3; }

        .sp-btn-save {
            padding: 7px 18px;
            border: none;
            border-radius: 5px;
            background: #16a34a;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.15s;
        }

        .sp-btn-save:hover { background: #15803d; }

        /* ===== END STUDY PLAN ===== */

        /* Protocols */
        .protocols-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .protocol-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 3px;
            transition: background 0.15s;
        }

        .protocol-item:hover {
            background: #f7f6f3;
        }

        .protocol-number {
            font-size: 13px;
            color: #9b9a97;
            min-width: 24px;
        }

        .protocol-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            font-size: 14px;
            padding: 4px 0;
            font-family: inherit;
        }

        .protocol-input:focus {
            outline: none;
            background: #ffffff;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 3px;
        }

        .protocol-input::placeholder {
            color: #9b9a97;
        }

        /* Habit Table */
        .habit-table-container {
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            overflow: hidden;
            background: #ffffff;
        }

        .habit-table-scroll {
            overflow-x: auto;
        }

        .habit-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .habit-table th {
            background: #f7f6f3;
            color: #9b9a97;
            font-size: 11px;
            font-weight: 600;
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #e9e9e7;
            border-right: 1px solid #e9e9e7;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .habit-table th:first-child {
            text-align: left;
            min-width: 180px;
            position: sticky;
            left: 0;
            z-index: 11;
            background: #f7f6f3;
        }

        .habit-table th:last-child {
            border-right: none;
        }

        .habit-table th.today {
            background: #2383e2;
            color: #ffffff;
        }

        .habit-table td {
            border-bottom: 1px solid #e9e9e7;
            border-right: 1px solid #e9e9e7;
            padding: 0;
        }

        .habit-table td:last-child {
            border-right: none;
        }

        .habit-table tr:last-child td {
            border-bottom: none;
        }

        .habit-name-cell {
            position: sticky;
            left: 0;
            background: #ffffff;
            z-index: 9;
        }

        .habit-name-input {
            width: 100%;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 10px 12px;
            font-size: 14px;
            font-family: inherit;
        }

        .habit-name-input:focus {
            outline: none;
            background: #f7f6f3;
        }

        .habit-cell {
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.15s;
            background: #ffffff;
            user-select: none;
        }

        .habit-cell:hover {
            background: #f7f6f3;
        }

        .habit-cell.completed {
            background: #e7f5ec;
            color: #0f7b6c;
        }

        .habit-cell.failed {
            background: #ffe2dd;
            color: #eb5757;
        }

        .success-rate {
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            padding: 10px 12px;
            color: #0f7b6c;
        }

        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
            margin-bottom: 32px;
        }

        @media (max-width: 1024px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }

        /* Goals */
        .goals-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .goal-item {
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 12px;
            background: #ffffff;
            transition: box-shadow 0.15s;
        }

        .goal-item:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .goal-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .goal-number {
            background: #f7f6f3;
            color: #37352f;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .goal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 4px 0;
            font-weight: 500;
            font-size: 14px;
            font-family: inherit;
        }

        .goal-input:focus {
            outline: none;
            background: #f7f6f3;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 3px;
        }

        .goal-input::placeholder {
            color: #9b9a97;
            font-weight: 400;
        }

        .goal-steps {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding-left: 30px;
        }

        .goal-step {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-checkbox {
            width: 16px;
            height: 16px;
            border: 1.5px solid #d3d3d1;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .step-checkbox:hover {
            background: #f7f6f3;
        }

        .step-checkbox.checked {
            background: #2383e2;
            border-color: #2383e2;
            color: #ffffff;
        }

        .step-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 4px 0;
            font-size: 13px;
            font-family: inherit;
        }

        .step-input:focus {
            outline: none;
            background: #f7f6f3;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 3px;
        }

        .step-input::placeholder {
            color: #9b9a97;
        }

        /* Achievements */
        .achievements-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .achievement-item {
            display: flex;
            align-items: start;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 3px;
            transition: background 0.15s;
        }

        .achievement-item:hover {
            background: #f7f6f3;
        }

        .achievement-bullet {
            color: #9b9a97;
            font-weight: 600;
            font-size: 16px;
            line-height: 1.5;
        }

        .achievement-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 2px 0;
            font-size: 14px;
            font-family: inherit;
        }

        .achievement-input:focus {
            outline: none;
        }

        .achievement-input::placeholder {
            color: #9b9a97;
        }

        /* Notes */
        .notes-textarea {
            width: 100%;
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            color: #37352f;
            padding: 12px;
            font-size: 14px;
            min-height: 200px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #2383e2;
            box-shadow: 0 0 0 1px #2383e2;
        }

        .notes-textarea::placeholder {
            color: #9b9a97;
        }

        /* Weekly View */
        .week-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 20px;
            margin-bottom: 16px;
            transition: box-shadow 0.15s;
        }

        .week-card:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e9e9e7;
        }

        .week-title {
            font-weight: 600;
            font-size: 18px;
            color: #37352f;
        }

        .week-dates {
            font-size: 13px;
            color: #9b9a97;
        }

        .week-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .week-stat {
            text-align: center;
            padding: 16px;
            background: #f7f6f3;
            border-radius: 3px;
        }

        .week-stat-value {
            font-size: 28px;
            font-weight: 600;
            color: #37352f;
            line-height: 1;
            margin-bottom: 4px;
        }

        .week-stat-label {
            font-size: 11px;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Yearly View */
        .year-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .year-title {
            font-size: 56px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 8px;
        }

        .year-subtitle {
            color: #9b9a97;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 48px;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 24px;
            text-align: center;
            transition: box-shadow 0.15s;
        }

        .stat-card:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            color: #37352f;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 11px;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .month-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .month-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .month-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #37352f;
        }

        .month-card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .month-stat {
            background: #f7f6f3;
            padding: 12px;
            border-radius: 3px;
        }

        .month-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #37352f;
            line-height: 1;
            margin-bottom: 4px;
        }

        .month-stat-label {
            font-size: 10px;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #d3d3d1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9b9a97;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">ðŸ“Š Momentum</div>
        </div>
        <div class="sidebar-nav" id="sidebarNav"></div>
        <div class="month-selector" id="monthSelector"></div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-items" id="mobileNav"></div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent"></div>

    <!-- Study Plan Modal -->
    <div class="sp-modal-overlay" id="spModalOverlay">
        <div class="sp-modal">
            <h3 id="spModalTitle">Assign Chapters</h3>
            <p class="sp-modal-sub" id="spModalSub">Choose chapters and target period</p>

            <label>Subject</label>
            <select id="spModalSubject"></select>

            <label>Target Period</label>
            <select id="spModalPeriod"></select>

            <label>Chapters to assign</label>
            <div id="spModalChapters" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;"></div>

            <div class="sp-modal-actions">
                <button class="sp-btn-cancel" onclick="closeStudyPlanModal()">Cancel</button>
                <button class="sp-btn-save"  onclick="saveStudyPlanModal()">Save</button>
            </div>
        </div>
    </div>

    <script>
    // â”€â”€â”€ Utility â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getDaysInMonth(year, month) {
        return new Date(year, month + 1, 0).getDate();
    }
    function getMonthName(m) {
        return ['January','February','March','April','May','June',
                'July','August','September','October','November','December'][m];
    }
    function getMonthShort(m) {
        return ['Jan','Feb','Mar','Apr','May','Jun',
                'Jul','Aug','Sep','Oct','Nov','Dec'][m];
    }
    function getDayName(date) {
        return ['Sun','Mon','Tue','Wed','Thu','Fri','Sat'][date.getDay()];
    }

    // â”€â”€â”€ Data Initialization â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function initializeMonthData(year, month) {
        return {
            year, month,
            protocols: Array(10).fill(''),
            habits: Array(12).fill(null).map((_,i) => ({
                name: `Habit ${i+1}`,
                days: Array(getDaysInMonth(year, month)).fill(null)
            })),
            goals: Array(5).fill(null).map(() => ({
                title: '',
                steps: Array(3).fill(null).map(() => ({text:'', completed:false}))
            })),
            achievements: Array(10).fill(''),
            notes: ''
        };
    }

    function initializeAcademicData() {
        return {
            subjects: [
                { name:'Business Math',           year:'2nd Year', chapters:Array(6).fill(false), examDate:'2026-09-15' },
                { name:'Business Statistics',     year:'3rd Year', chapters:Array(6).fill(false), examDate:'2026-11-01' },
                { name:'Management Accounting',   year:'3rd Year', chapters:Array(6).fill(false), examDate:'2026-11-02' },
                { name:'Taxation in Bangladesh',  year:'3rd Year', chapters:Array(6).fill(false), examDate:'2026-08-03' },
                { name:'Financial Management',    year:'4th Year', chapters:Array(6).fill(false), examDate:'2026-12-01' },
                { name:'Project Management',      year:'4th Year', chapters:Array(6).fill(false), examDate:'2026-12-02' },
                { name:'Investment Management',   year:'4th Year', chapters:Array(6).fill(false), examDate:'2026-12-03' }
            ]
        };
    }

    /**
     * studyPlans structure  (persisted in localStorage key "studyPlans")
     * {
     *   "<subjectIndex>": {
     *     months: {
     *       "<YYYY-MM>": { chapters:[1,3], hours: "4" }   // which chapters targeted, hours/week
     *     },
     *     weeks: {
     *       "<YYYY>-W<weekNumber>": { chapters:[2], hours:"2" }
     *     }
     *   }
     * }
     */
    function initializeStudyPlans() {
        let plans = {};
        return plans;
    }

    // â”€â”€â”€ App State â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let state = {
        view: 'monthly',
        selectedMonth: { year: new Date().getFullYear(), month: new Date().getMonth() },
        yearData: {},
        academicData: null,
        studyPlans: {},
        // study-plan UI state
        spView: 'monthly',          // 'monthly' | 'weekly'
        spSelectedSubject: 0
    };

    let progressChart = null;

    // â”€â”€â”€ Persistence â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function loadData() {
        const saved = localStorage.getItem('momentumTracker');
        if (saved) state.yearData = JSON.parse(saved);
        else {
            const y = new Date().getFullYear();
            for (let m=0; m<12; m++) state.yearData[`${y}-${m}`] = initializeMonthData(y,m);
        }

        const acSaved = localStorage.getItem('academicTracker');
        state.academicData = acSaved ? JSON.parse(acSaved) : initializeAcademicData();

        const spSaved = localStorage.getItem('studyPlans');
        state.studyPlans = spSaved ? JSON.parse(spSaved) : initializeStudyPlans();
    }

    function saveData() {
        localStorage.setItem('momentumTracker', JSON.stringify(state.yearData));
        localStorage.setItem('academicTracker', JSON.stringify(state.academicData));
        localStorage.setItem('studyPlans',      JSON.stringify(state.studyPlans));
    }

    // â”€â”€â”€ Month data helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getCurrentMonthData() {
        const key = `${state.selectedMonth.year}-${state.selectedMonth.month}`;
        if (!state.yearData[key])
            state.yearData[key] = initializeMonthData(state.selectedMonth.year, state.selectedMonth.month);
        return state.yearData[key];
    }
    function updateMonthData(updates) {
        const key = `${state.selectedMonth.year}-${state.selectedMonth.month}`;
        state.yearData[key] = { ...getCurrentMonthData(), ...updates };
        saveData();
        render();
    }

    // â”€â”€â”€ Navigation â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function changeView(v) { state.view = v; render(); }
    function changeMonth(dir) {
        let m = state.selectedMonth.month + dir, y = state.selectedMonth.year;
        if (m>11) { m=0; y++; } else if (m<0) { m=11; y--; }
        state.selectedMonth = {year:y, month:m};
        render();
    }
    function selectMonth(year, month) {
        state.selectedMonth = {year, month};
        state.view = 'monthly';
        render();
    }

    // â”€â”€â”€ Academic helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function toggleChapter(si, ci) {
        state.academicData.subjects[si].chapters[ci] = !state.academicData.subjects[si].chapters[ci];
        saveData(); render();
    }

    // â”€â”€â”€ Study Plan helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function getSubjectPlan(si) {
        if (!state.studyPlans[si]) state.studyPlans[si] = { months:{}, weeks:{} };
        return state.studyPlans[si];
    }

    // ISO week number for a date
    function getISOWeek(date) {
        const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
        const dayNum = d.getUTCDay() || 7;
        d.setUTCDate(d.getUTCDate() + 4 - dayNum);
        const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
        return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
    }

    // Get weeks (Monâ€“Sun) that overlap a given month
    function getWeeksForMonth(year, month) {
        const days = getDaysInMonth(year, month);
        const weeks = [];
        const seen = new Set();
        for (let d = 1; d <= days; d++) {
            const date = new Date(year, month, d);
            const wk = getISOWeek(date);
            const key = `${year}-W${wk}`;
            if (!seen.has(key)) { seen.add(key); weeks.push({ key, week: wk, year }); }
        }
        return weeks;
    }

    // â”€â”€â”€ Study Plan Modal â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    let spModalContext = {}; // { subjectIndex, periodKey }

    function openStudyPlanModal(subjectIndex, periodKey) {
        spModalContext = { subjectIndex, periodKey };
        const subj = state.academicData.subjects[subjectIndex];
        const plan = getSubjectPlan(subjectIndex);
        const existing = (state.spView === 'monthly'
            ? (plan.months[periodKey] || {})
            : (plan.weeks[periodKey] || {}));

        // Subject dropdown (read-only display)
        const sSelect = document.getElementById('spModalSubject');
        sSelect.innerHTML = state.academicData.subjects.map((s,i) =>
            `<option value="${i}" ${i===subjectIndex?'selected':''}>${s.name}</option>`
        ).join('');
        sSelect.disabled = true;

        // Period dropdown (read-only)
        const pSelect = document.getElementById('spModalPeriod');
        pSelect.innerHTML = `<option value="${periodKey}" selected>${periodKey.replace('W',' W')}</option>`;
        pSelect.disabled = true;

        // Chapter checkboxes
        const chDiv = document.getElementById('spModalChapters');
        chDiv.innerHTML = '';
        for (let c = 1; c <= 6; c++) {
            const checked = existing.chapters && existing.chapters.includes(c);
            const done = subj.chapters[c-1]; // already completed
            chDiv.innerHTML += `
                <label style="display:inline-flex;align-items:center;gap:5px;padding:5px 10px;
                    border:1px solid ${done?'#a5d6a7':'#e9e9e7'};border-radius:5px;
                    background:${done?'#e8f5e9':'#fff'};cursor:pointer;font-size:12px;user-select:none;"
                >
                    <input type="checkbox" data-ch="${c}" ${checked?'checked':''} ${done?'disabled':''} style="accent-color:#16a34a;">
                    Ch ${c} ${done?'âœ“':''}
                </label>`;
        }

        document.getElementById('spModalTitle').textContent = `Plan: ${subj.name}`;
        document.getElementById('spModalSub').textContent   = `Assign chapters for ${periodKey.replace('W',' Week ')}`;
        document.getElementById('spModalOverlay').classList.add('visible');
    }

    function closeStudyPlanModal() {
        document.getElementById('spModalOverlay').classList.remove('visible');
        spModalContext = {};
    }

    function saveStudyPlanModal() {
        const { subjectIndex, periodKey } = spModalContext;
        const plan = getSubjectPlan(subjectIndex);
        const store = state.spView === 'monthly' ? plan.months : plan.weeks;

        const chapters = [];
        document.querySelectorAll('#spModalChapters input[type=checkbox]').forEach(cb => {
            if (cb.checked) chapters.push(parseInt(cb.dataset.ch));
        });

        if (!store[periodKey]) store[periodKey] = { chapters:[], hours:'' };
        store[periodKey].chapters = chapters;

        saveData();
        closeStudyPlanModal();
        render();
    }

    function updateTimeAllocation(subjectIndex, periodKey, value) {
        const plan = getSubjectPlan(subjectIndex);
        const store = state.spView === 'monthly' ? plan.months : plan.weeks;
        if (!store[periodKey]) store[periodKey] = { chapters:[], hours:'' };
        store[periodKey].hours = value;
        saveData();
    }

    // â”€â”€â”€ Render: Progress Chart â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderProgressChart() {
        const monthData = getCurrentMonthData();
        const daysInMonth = getDaysInMonth(state.selectedMonth.year, state.selectedMonth.month);
        const dailyData = [];
        for (let day=0; day<daysInMonth; day++) {
            let completed=0, failed=0;
            monthData.habits.forEach(h => {
                if (h.days[day]==='completed') completed++;
                else if (h.days[day]==='failed') failed++;
            });
            dailyData.push({completed, failed});
        }
        const totalCompleted = dailyData.reduce((s,d)=>s+d.completed,0);
        const totalFailed    = dailyData.reduce((s,d)=>s+d.failed,0);

        return {
            html:`<div class="chart-section">
                <div class="chart-header">
                    <div class="chart-title">ðŸ“ˆ Your Progress Flow</div>
                    <div class="chart-stats">
                        <div class="chart-stat"><div class="stat-dot completed"></div><span>${totalCompleted} Completed</span></div>
                        <div class="chart-stat"><div class="stat-dot failed"></div><span>${totalFailed} Failed</span></div>
                    </div>
                </div>
                <div class="chart-container"><canvas id="progressChart"></canvas></div>
            </div>`,
            dailyData
        };
    }

    function createChart(dailyData) {
        const ctx = document.getElementById('progressChart');
        if (!ctx) return;
        if (progressChart) progressChart.destroy();
        progressChart = new Chart(ctx, {
            type:'line',
            data:{
                labels: dailyData.map((_,i)=>i+1),
                datasets:[
                    { label:'Completed', data:dailyData.map(d=>d.completed), borderColor:'#10b981', backgroundColor:'rgba(16,185,129,0.1)', tension:0.4, fill:true },
                    { label:'Failed',    data:dailyData.map(d=>d.failed),    borderColor:'#ef4444', backgroundColor:'rgba(239,68,68,0.1)',   tension:0.4, fill:true }
                ]
            },
            options:{
                responsive:true, maintainAspectRatio:false,
                plugins:{ legend:{display:false}, tooltip:{mode:'index',intersect:false} },
                scales:{
                    y:{ beginAtZero:true, ticks:{stepSize:1}, grid:{color:'#e9e9e7'} },
                    x:{ grid:{display:false} }
                }
            }
        });
    }

    // â”€â”€â”€ Render: Academic Tracker (chapter cards) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderAcademicTracker() {
        const today = new Date();
        let html = `<div class="academic-section">
            <div class="academic-header">
                <div>
                    <div class="academic-title">ðŸŽ“ Academic Progress Tracker</div>
                    <div class="academic-subtitle">BBA Management â€¢ National University â€¢ 2021-22 Session</div>
                </div>
                <div class="academic-badge">4th Year</div>
            </div>
            <div class="subjects-grid">`;

        state.academicData.subjects.forEach((subj, si) => {
            const completed = subj.chapters.filter(c=>c).length;
            const progress  = Math.round((completed/6)*100);
            const examDate  = new Date(subj.examDate);
            const daysLeft  = Math.ceil((examDate - today)/(86400000));
            const weeksNeeded = 6 - completed;
            const deadlineClass = daysLeft<30 ? 'deadline-warning' : 'deadline-good';

            html += `<div class="subject-card">
                <div class="subject-header">
                    <div class="subject-name">${subj.name}</div>
                    <div class="year-badge">${subj.year}</div>
                </div>
                <div class="subject-progress">
                    <div class="progress-bar"><div class="progress-fill" style="width:${progress}%"></div></div>
                    <div class="progress-text"><span>${completed}/6 Chapters</span><span>${progress}%</span></div>
                </div>
                <div class="chapters-grid">`;

            subj.chapters.forEach((done, ci) => {
                html += `<div class="chapter-box ${done?'completed':''}" onclick="toggleChapter(${si},${ci})">${ci+1}</div>`;
            });

            html += `</div>
                <div class="subject-meta">
                    <div class="meta-item"><div class="meta-label">Exam Date</div><div class="meta-value">${examDate.toLocaleDateString('en-US',{month:'short',day:'numeric'})}</div></div>
                    <div class="meta-item"><div class="meta-label">Days Left</div><div class="meta-value ${deadlineClass}">${daysLeft}d</div></div>
                    <div class="meta-item"><div class="meta-label">Weeks Needed</div><div class="meta-value">${weeksNeeded}w</div></div>
                </div>
            </div>`;
        });

        html += '</div></div>';
        return html;
    }

    // â”€â”€â”€ Render: Study Plan Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderStudyPlan() {
        const si = state.spSelectedSubject;
        const subj = state.academicData.subjects[si];
        const plan = getSubjectPlan(si);
        const year = new Date().getFullYear();

        // â”€â”€ Subject pills â”€â”€
        let pillsHtml = '';
        state.academicData.subjects.forEach((s, i) => {
            pillsHtml += `<button class="sp-subject-pill ${i===si?'active':''}"
                onclick="state.spSelectedSubject=${i};render();">${s.name}</button>`;
        });

        // â”€â”€ Tab buttons â”€â”€
        const tabs = `<div class="study-plan-tabs">
            <button class="sp-study-plan-tab ${state.spView==='monthly'?'active':''}"
                onclick="state.spView='monthly';render();">Monthly</button>
            <button class="sp-study-plan-tab ${state.spView==='weekly'?'active':''}"
                onclick="state.spView='weekly';render();">Weekly</button>
        </div>`;

        // â”€â”€ Build period columns â”€â”€
        let periods = [];
        if (state.spView === 'monthly') {
            // Feb 2026 â€“ Dec 2026
            for (let m = 1; m < 12; m++) {
                periods.push({ key:`${year}-${String(m+1).padStart(2,'0')}`, label: getMonthShort(m) });
            }
        } else {
            // Weeks overlapping current month (and surrounding)
            // Show weeks from Feb through Dec
            const allWeeks = new Map();
            for (let m = 1; m < 12; m++) {
                getWeeksForMonth(year, m).forEach(w => {
                    if (!allWeeks.has(w.key)) allWeeks.set(w.key, w);
                });
            }
            allWeeks.forEach(w => {
                periods.push({ key: w.key, label: `W${w.week}` });
            });
        }

        // â”€â”€ Table header â”€â”€
        let theadHtml = '<tr><th style="min-width:150px;position:sticky;left:0;z-index:2;background:#f7f6f3;">Chapter</th>';
        periods.forEach(p => { theadHtml += `<th class="sp-month-head">${p.label}</th>`; });
        theadHtml += '</tr>';

        // â”€â”€ Chapter rows â”€â”€
        let tbodyHtml = '';
        for (let ch = 1; ch <= 6; ch++) {
            const chDone = subj.chapters[ch-1];
            tbodyHtml += `<tr>
                <td class="sp-row-label" style="${chDone?'color:#9b9a97;text-decoration:line-through;':''}"
                >Chapter ${ch} ${chDone?'<span style="color:#16a34a;font-size:11px;">(done)</span>':''}</td>`;

            periods.forEach(p => {
                const store = state.spView==='monthly' ? plan.months : plan.weeks;
                const entry = store[p.key] || {};
                const assigned = entry.chapters && entry.chapters.includes(ch);

                if (assigned) {
                    tbodyHtml += `<td class="sp-cell" style="cursor:pointer;background:#e8f5e9;" onclick="openStudyPlanModal(${si},'${p.key}')">
                        <span class="sp-chapter-pill ${chDone?'done':''}">Ch ${ch}</span>
                    </td>`;
                } else {
                    tbodyHtml += `<td class="sp-cell" style="cursor:pointer;" onclick="openStudyPlanModal(${si},'${p.key}')">
                        <span style="color:#ccc;font-size:14px;">+</span>
                    </td>`;
                }
            });
            tbodyHtml += '</tr>';
        }

        // â”€â”€ Time allocation row â”€â”€
        tbodyHtml += `<tr class="sp-time-row">
            <td class="sp-row-label" style="background:#fefce8;font-weight:600;color:#854d0e;">â± Hours/week</td>`;
        periods.forEach(p => {
            const store = state.spView==='monthly' ? plan.months : plan.weeks;
            const entry = store[p.key] || {};
            tbodyHtml += `<td class="sp-cell" style="background:#fefce8;">
                <input type="number" class="sp-time-input" placeholder="0"
                    value="${entry.hours||''}"
                    onchange="updateTimeAllocation(${si},'${p.key}',this.value)"
                    onblur="updateTimeAllocation(${si},'${p.key}',this.value)">
                <div class="sp-time-label">${state.spView==='monthly'?'hrs/week':'hrs/wk'}</div>
            </td>`;
        });
        tbodyHtml += '</tr>';

        // â”€â”€ Summary cards â”€â”€
        const totalPlanned = (() => {
            const allCh = new Set();
            const store = state.spView==='monthly' ? plan.months : plan.weeks;
            Object.values(store).forEach(e => (e.chapters||[]).forEach(c => allCh.add(c)));
            return allCh.size;
        })();
        const totalDone = subj.chapters.filter(c=>c).length;
        const totalHours = (() => {
            const store = state.spView==='monthly' ? plan.months : plan.weeks;
            return Object.values(store).reduce((s,e) => s + (parseFloat(e.hours)||0), 0);
        })();
        const unplanned = 6 - totalPlanned;

        let summaryHtml = `<div class="sp-summary-bar">
            <div class="sp-summary-card">
                <div class="sp-summary-icon green">ðŸ“…</div>
                <div class="sp-summary-text"><div class="sp-sum-val">${totalPlanned}</div><div class="sp-sum-label">Chapters Planned</div></div>
            </div>
            <div class="sp-summary-card">
                <div class="sp-summary-icon blue">âœ…</div>
                <div class="sp-summary-text"><div class="sp-sum-val">${totalDone}</div><div class="sp-sum-label">Chapters Done</div></div>
            </div>
            <div class="sp-summary-card">
                <div class="sp-summary-icon amber">â±</div>
                <div class="sp-summary-text"><div class="sp-sum-val">${totalHours}h</div><div class="sp-sum-label">Total Hours Set</div></div>
            </div>
            <div class="sp-summary-card">
                <div class="sp-summary-icon ${unplanned>0?'red':'green'}">ðŸ“–</div>
                <div class="sp-summary-text"><div class="sp-sum-val">${unplanned}</div><div class="sp-sum-label">Unplanned</div></div>
            </div>
        </div>`;

        return `<div class="study-plan-section">
            <div class="study-plan-header">
                <div class="study-plan-header-left">
                    <h2>ðŸ“ Study Plan</h2>
                    <p>Set targets â€” assign chapters to specific weeks or months & allocate study hours</p>
                </div>
                ${tabs}
            </div>
            <div class="sp-subject-selector">${pillsHtml}</div>
            <div class="sp-plan-wrapper">
                <table class="sp-plan-table">
                    <thead>${theadHtml}</thead>
                    <tbody>${tbodyHtml}</tbody>
                </table>
            </div>
            ${summaryHtml}
        </div>`;
    }

    // â”€â”€â”€ Render: Sidebar â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderSidebar() {
        const navItems = [
            { id:'monthly',   icon:'ðŸ“…', label:'Monthly Tracker' },
            { id:'academics', icon:'ðŸŽ“', label:'Academic Tracker' },
            { id:'weekly',    icon:'ðŸ“Š', label:'Weekly Analysis' },
            { id:'yearly',    icon:'ðŸ“ˆ', label:'Yearly Overview' }
        ];
        document.getElementById('sidebarNav').innerHTML = navItems.map(item =>
            `<div class="nav-item ${state.view===item.id?'active':''}" onclick="changeView('${item.id}')">
                <span class="nav-icon">${item.icon}</span>${item.label}</div>`
        ).join('');

        document.getElementById('monthSelector').innerHTML = state.view==='monthly' ? `
            <div class="month-selector-title">Navigate</div>
            <div class="month-controls">
                <button onclick="changeMonth(-1)">â†</button>
                <span class="month-name">${getMonthName(state.selectedMonth.month)} ${state.selectedMonth.year}</span>
                <button onclick="changeMonth(1)">â†’</button>
            </div>` : '';

        document.getElementById('mobileNav').innerHTML = navItems.map(item =>
            `<button class="mobile-nav-item ${state.view===item.id?'active':''}" onclick="changeView('${item.id}')">${item.icon}</button>`
        ).join('');
    }

    // â”€â”€â”€ Render: Monthly View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderMonthly() {
        const monthData = getCurrentMonthData();
        const daysInMonth = getDaysInMonth(state.selectedMonth.year, state.selectedMonth.month);
        const today = new Date();
        const isCurrentMonth = state.selectedMonth.year===today.getFullYear() && state.selectedMonth.month===today.getMonth();

        let html = `<div class="page-header">
            <h1 class="page-title">${getMonthName(state.selectedMonth.month)} ${state.selectedMonth.year}</h1>
            <div class="page-subtitle">${daysInMonth} days to build momentum</div>
            ${isCurrentMonth?`<div class="today-badge">Today: ${getDayName(today)}, ${getMonthName(today.getMonth())} ${today.getDate()}</div>`:''}
        </div>`;

        const chartData = renderProgressChart();
        html += chartData.html;
        html += renderAcademicTracker();
        html += renderStudyPlan();

        // Two column
        html += '<div class="two-column"><div>';

        // Protocols
        html += `<div class="section"><div class="section-header"><span class="section-icon">ðŸ“‹</span><h2 class="section-title">Daily Protocols</h2></div><div class="protocols-list">`;
        monthData.protocols.forEach((p,i) => {
            html += `<div class="protocol-item"><div class="protocol-number">${i+1}.</div>
                <input type="text" class="protocol-input" value="${p}" onchange="updateProtocol(${i},this.value)" placeholder="What must you do every day?"></div>`;
        });
        html += '</div></div></div>';

        // Right column
        html += '<div>';

        // Goals
        html += `<div class="section"><div class="section-header"><span class="section-icon">ðŸŽ¯</span><h2 class="section-title">Major Goals</h2></div><div class="goals-list">`;
        monthData.goals.forEach((goal, gi) => {
            html += `<div class="goal-item"><div class="goal-header">
                <div class="goal-number">${gi+1}</div>
                <input type="text" class="goal-input" value="${goal.title}" onchange="updateGoal(${gi},this.value)" placeholder="What do you want to achieve?">
            </div><div class="goal-steps">`;
            goal.steps.forEach((step, si2) => {
                html += `<div class="goal-step">
                    <div class="step-checkbox ${step.completed?'checked':''}" onclick="toggleStep(${gi},${si2})">${step.completed?'âœ“':''}</div>
                    <input type="text" class="step-input" value="${step.text}" onchange="updateStep(${gi},${si2},this.value)" placeholder="Action step...">
                </div>`;
            });
            html += '</div></div>';
        });
        html += '</div></div>';

        // Achievements
        html += `<div class="section"><div class="section-header"><span class="section-icon">ðŸ†</span><h2 class="section-title">Achievements</h2></div><div class="achievements-list">`;
        monthData.achievements.forEach((a,i) => {
            html += `<div class="achievement-item"><div class="achievement-bullet">â€¢</div>
                <input type="text" class="achievement-input" value="${a}" onchange="updateAchievement(${i},this.value)" placeholder="What did you accomplish?"></div>`;
        });
        html += '</div></div>';

        // Notes
        html += `<div class="section"><div class="section-header"><span class="section-icon">ðŸ“</span><h2 class="section-title">Notes & Reflections</h2></div>
            <textarea class="notes-textarea" onchange="updateNotes(this.value)" placeholder="Reflect on your month...">${monthData.notes}</textarea></div>`;

        html += '</div></div>'; // end two-column

        // Habit Tracker
        html += `<div class="section"><div class="section-header"><span class="section-icon">âœ…</span><h2 class="section-title">Habit Tracker</h2></div>
            <div class="habit-table-container"><div class="habit-table-scroll"><table class="habit-table"><thead><tr><th>Habit</th>`;
        for (let d=1; d<=daysInMonth; d++) {
            const date = new Date(state.selectedMonth.year, state.selectedMonth.month, d);
            const isTodayClass = (isCurrentMonth && d===today.getDate()) ? 'today' : '';
            html += `<th class="${isTodayClass}"><div>${d}</div><div>${getDayName(date)}</div></th>`;
        }
        html += '<th>%</th></tr></thead><tbody>';

        monthData.habits.forEach((habit, hi) => {
            const tracked   = habit.days.filter(d=>d!==null).length;
            const completed = habit.days.filter(d=>d==='completed').length;
            const rate      = tracked>0 ? Math.round((completed/tracked)*100) : 0;
            html += `<tr><td class="habit-name-cell"><input type="text" class="habit-name-input" value="${habit.name}" onchange="updateHabitName(${hi},this.value)"></td>`;
            habit.days.forEach((status, di) => {
                const symbol = status==='completed'?'âœ“':(status==='failed'?'âœ—':'');
                html += `<td><div class="habit-cell ${status||''}" onclick="toggleHabitDay(${hi},${di})">${symbol}</div></td>`;
            });
            html += `<td class="success-rate">${rate}%</td></tr>`;
        });
        html += '</tbody></table></div></div></div>';

        return { html, chartData: chartData.dailyData };
    }

    // â”€â”€â”€ Render: Academics View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderAcademics() {
        let html = `<div class="page-header">
            <h1 class="page-title">Academic Progress</h1>
            <div class="page-subtitle">BBA Management â€¢ National University â€¢ Track your study goals</div>
        </div>`;
        html += renderAcademicTracker();
        html += renderStudyPlan();

        const totalCh = state.academicData.subjects.length * 6;
        const doneCh  = state.academicData.subjects.reduce((s,sub) => s + sub.chapters.filter(c=>c).length, 0);
        const overall = Math.round((doneCh/totalCh)*100);
        const subjDone = state.academicData.subjects.filter(s=>s.chapters.every(c=>c)).length;

        html += `<div class="section" style="margin-top:32px;">
            <div class="section-header"><span class="section-icon">ðŸ“Š</span><h2 class="section-title">Overall Statistics</h2></div>
            <div class="stats-grid">
                <div class="stat-card"><div class="stat-value">${overall}%</div><div class="stat-label">Overall Progress</div></div>
                <div class="stat-card"><div class="stat-value">${doneCh}</div><div class="stat-label">Chapters Done</div></div>
                <div class="stat-card"><div class="stat-value">${totalCh-doneCh}</div><div class="stat-label">Chapters Left</div></div>
                <div class="stat-card"><div class="stat-value">${subjDone}</div><div class="stat-label">Subjects Done</div></div>
            </div>
        </div>`;
        return html;
    }

    // â”€â”€â”€ Render: Weekly View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderWeekly() {
        const monthData = getCurrentMonthData();
        const daysInMonth = getDaysInMonth(state.selectedMonth.year, state.selectedMonth.month);
        let weeks = [], cur = [];
        for (let d=1; d<=daysInMonth; d++) {
            const date = new Date(state.selectedMonth.year, state.selectedMonth.month, d);
            cur.push({day:d, dow:date.getDay()});
            if (date.getDay()===6 || d===daysInMonth) { weeks.push([...cur]); cur=[]; }
        }

        let html = `<div class="page-header">
            <h1 class="page-title">Weekly Breakdown</h1>
            <div class="page-subtitle">${getMonthName(state.selectedMonth.month)} ${state.selectedMonth.year} â€¢ ${weeks.length} weeks</div>
        </div>`;

        weeks.forEach((week, wi) => {
            let tc=0, tf=0, tt=0;
            monthData.habits.forEach(h => {
                week.forEach(({day}) => {
                    const s = h.days[day-1];
                    if (s==='completed') tc++;
                    else if (s==='failed') tf++;
                    if (s!==null) tt++;
                });
            });
            const rate = tt>0 ? Math.round((tc/tt)*100) : 0;
            html += `<div class="week-card">
                <div class="week-header">
                    <div class="week-title">Week ${wi+1}</div>
                    <div class="week-dates">${getMonthName(state.selectedMonth.month)} ${week[0].day}-${week[week.length-1].day}</div>
                </div>
                <div class="week-stats">
                    <div class="week-stat"><div class="week-stat-value">${rate}%</div><div class="week-stat-label">Success Rate</div></div>
                    <div class="week-stat"><div class="week-stat-value">${tc}</div><div class="week-stat-label">Completed</div></div>
                    <div class="week-stat"><div class="week-stat-value">${tf}</div><div class="week-stat-label">Failed</div></div>
                    <div class="week-stat"><div class="week-stat-value">${tt}</div><div class="week-stat-label">Tracked</div></div>
                </div>
            </div>`;
        });
        return html;
    }

    // â”€â”€â”€ Render: Yearly View â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function renderYearly() {
        const currentYear = state.selectedMonth.year;
        let monthsData = [];
        for (let m=0; m<12; m++) {
            const data = state.yearData[`${currentYear}-${m}`] || initializeMonthData(currentYear, m);
            let tc=0, tf=0, tt=0;
            data.habits.forEach(h => h.days.forEach(s => {
                if (s==='completed') tc++;
                else if (s==='failed') tf++;
                if (s!==null) tt++;
            }));
            const rate = tt>0 ? Math.round((tc/tt)*100) : 0;
            const gc = data.goals.filter(g => g.title && g.steps.every(s=>s.completed||s.text==='')).length;
            monthsData.push({ month:m, successRate:rate, totalCompleted:tc, totalTracked:tt, goalsCompleted:gc });
        }

        const totC  = monthsData.reduce((s,m)=>s+m.totalCompleted,0);
        const totT  = monthsData.reduce((s,m)=>s+m.totalTracked,0);
        const totG  = monthsData.reduce((s,m)=>s+m.goalsCompleted,0);
        const avgS  = Math.round(monthsData.reduce((s,m)=>s+m.successRate,0)/12);

        let html = `<div class="year-header">
            <h1 class="year-title">${currentYear}</h1>
            <div class="year-subtitle">Your Year in Review</div>
        </div>
        <div class="stats-grid">
            <div class="stat-card"><div class="stat-value">${avgS}%</div><div class="stat-label">Avg Success</div></div>
            <div class="stat-card"><div class="stat-value">${totC}</div><div class="stat-label">Completed</div></div>
            <div class="stat-card"><div class="stat-value">${totT}</div><div class="stat-label">Tracked</div></div>
            <div class="stat-card"><div class="stat-value">${totG}</div><div class="stat-label">Goals Done</div></div>
        </div>
        <div class="months-grid">`;

        monthsData.forEach(d => {
            html += `<div class="month-card" onclick="selectMonth(${currentYear},${d.month})">
                <div class="month-card-title">${getMonthName(d.month)}</div>
                <div class="month-card-stats">
                    <div class="month-stat"><div class="month-stat-value">${d.successRate}%</div><div class="month-stat-label">Success</div></div>
                    <div class="month-stat"><div class="month-stat-value">${d.totalCompleted}</div><div class="month-stat-label">Completed</div></div>
                    <div class="month-stat"><div class="month-stat-value">${d.totalTracked}</div><div class="month-stat-label">Tracked</div></div>
                    <div class="month-stat"><div class="month-stat-value">${d.goalsCompleted}</div><div class="month-stat-label">Goals</div></div>
                </div>
            </div>`;
        });
        html += '</div>';
        return html;
    }

    // â”€â”€â”€ Update Handlers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function updateProtocol(i, v)    { const d=getCurrentMonthData(); d.protocols[i]=v; updateMonthData({protocols:d.protocols}); }
    function updateHabitName(i, n)   { const d=getCurrentMonthData(); d.habits[i].name=n; updateMonthData({habits:d.habits}); }
    function toggleHabitDay(hi, di)  {
        const d=getCurrentMonthData();
        const cur=d.habits[hi].days[di];
        d.habits[hi].days[di] = cur===null?'completed':(cur==='completed'?'failed':null);
        updateMonthData({habits:d.habits});
    }
    function updateGoal(i, v)        { const d=getCurrentMonthData(); d.goals[i].title=v; updateMonthData({goals:d.goals}); }
    function updateStep(gi, si, v)   { const d=getCurrentMonthData(); d.goals[gi].steps[si].text=v; updateMonthData({goals:d.goals}); }
    function toggleStep(gi, si)      { const d=getCurrentMonthData(); d.goals[gi].steps[si].completed=!d.goals[gi].steps[si].completed; updateMonthData({goals:d.goals}); }
    function updateAchievement(i, v) { const d=getCurrentMonthData(); d.achievements[i]=v; updateMonthData({achievements:d.achievements}); }
    function updateNotes(v)          { updateMonthData({notes:v}); }

    // â”€â”€â”€ Main Render â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    function render() {
        renderSidebar();
        let content='', chartData=null;

        if      (state.view==='monthly')   { const r=renderMonthly(); content=r.html; chartData=r.chartData; }
        else if (state.view==='academics') { content=renderAcademics(); }
        else if (state.view==='weekly')    { content=renderWeekly(); }
        else if (state.view==='yearly')    { content=renderYearly(); }

        document.getElementById('mainContent').innerHTML = content;
        if (chartData) setTimeout(()=>createChart(chartData), 100);
    }

    // â”€â”€â”€ Init â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
    loadData();
    render();

    // Close modal on overlay click
    document.getElementById('spModalOverlay').addEventListener('click', function(e) {
        if (e.target === this) closeStudyPlanModal();
    });
    </script>
</body>
</html>