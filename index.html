<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Momentum Tracker</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700&display=swap" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            background: #ffffff;
            color: #37352f;
            line-height: 1.5;
        }

        /* Sidebar */
        .sidebar {
            position: fixed;
            left: 0;
            top: 0;
            width: 240px;
            height: 100vh;
            background: #f7f6f3;
            border-right: 1px solid #e9e9e7;
            padding: 12px;
            overflow-y: auto;
            z-index: 100;
        }

        .sidebar-header {
            padding: 8px 12px;
            margin-bottom: 20px;
        }

        .sidebar-title {
            font-size: 14px;
            font-weight: 600;
            color: #37352f;
        }

        .sidebar-nav {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .nav-item {
            padding: 6px 12px;
            border-radius: 3px;
            cursor: pointer;
            font-size: 14px;
            color: #37352f;
            transition: background 0.15s;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .nav-item:hover {
            background: #efefed;
        }

        .nav-item.active {
            background: #e3e2e0;
            font-weight: 500;
        }

        .nav-icon {
            font-size: 16px;
            width: 20px;
            text-align: center;
        }

        .month-selector {
            margin-top: 24px;
            padding-top: 24px;
            border-top: 1px solid #e9e9e7;
        }

        .month-selector-title {
            font-size: 11px;
            font-weight: 600;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            padding: 0 12px;
            margin-bottom: 8px;
        }

        .month-controls {
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: 6px 12px;
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            margin-bottom: 8px;
        }

        .month-controls button {
            background: transparent;
            border: none;
            color: #37352f;
            cursor: pointer;
            padding: 4px 8px;
            border-radius: 3px;
            font-size: 18px;
            line-height: 1;
        }

        .month-controls button:hover {
            background: #efefed;
        }

        .month-name {
            font-size: 14px;
            font-weight: 500;
            color: #37352f;
        }

        /* Main Content */
        .main-content {
            margin-left: 240px;
            padding: 48px 96px;
            max-width: 1600px;
        }

        @media (max-width: 1024px) {
            .sidebar {
                width: 0;
                padding: 0;
                overflow: hidden;
            }
            
            .main-content {
                margin-left: 0;
                padding: 24px;
            }
            
            .mobile-nav {
                display: block !important;
            }
        }

        .mobile-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: #ffffff;
            border-top: 1px solid #e9e9e7;
            padding: 8px;
            z-index: 100;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            overflow-x: auto;
        }

        .mobile-nav-item {
            padding: 8px 12px;
            font-size: 11px;
            border-radius: 3px;
            cursor: pointer;
            background: transparent;
            border: none;
            color: #37352f;
            white-space: nowrap;
        }

        .mobile-nav-item.active {
            background: #e3e2e0;
        }

        /* Page Header */
        .page-header {
            margin-bottom: 24px;
        }

        .page-title {
            font-size: 40px;
            font-weight: 700;
            line-height: 1.2;
            margin-bottom: 4px;
            color: #37352f;
        }

        .page-subtitle {
            font-size: 14px;
            color: #9b9a97;
        }

        .today-badge {
            display: inline-block;
            background: #e9e9e7;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 12px;
            color: #787774;
            margin-top: 8px;
        }

        /* Chart Section */
        .chart-section {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .chart-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .chart-title {
            font-size: 18px;
            font-weight: 600;
            color: #37352f;
        }

        .chart-stats {
            display: flex;
            gap: 20px;
            font-size: 13px;
        }

        .chart-stat {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .stat-dot {
            width: 10px;
            height: 10px;
            border-radius: 50%;
        }

        .stat-dot.completed {
            background: #0f7b6c;
        }

        .stat-dot.failed {
            background: #eb5757;
        }

        .chart-container {
            position: relative;
            height: 200px;
        }

        /* Section */
        .section {
            margin-bottom: 32px;
        }

        .section-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
            padding: 4px 0;
        }

        .section-icon {
            font-size: 18px;
        }

        .section-title {
            font-size: 16px;
            font-weight: 600;
            color: #37352f;
        }

        /* Academic Tracker */
        .academic-section {
            background: #fefce8;
            border: 1px solid #fde047;
            border-radius: 3px;
            padding: 20px;
            margin-bottom: 32px;
        }

        /* ===== STUDY PLAN STYLES ===== */
        .study-plan-section {
            background: #f0fdf4;
            border: 1px solid #86efac;
            border-radius: 6px;
            padding: 24px;
            margin-bottom: 32px;
        }

        .study-plan-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .study-plan-header-left h2 {
            font-size: 20px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 2px;
        }

        .study-plan-header-left p {
            font-size: 13px;
            color: #78716c;
        }

        .study-plan-tabs {
            display: flex;
            gap: 4px;
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            padding: 3px;
        }

        .study-plan-tab {
            padding: 6px 14px;
            border: none;
            border-radius: 4px;
            background: transparent;
            font-size: 13px;
            font-weight: 500;
            color: #78716c;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
        }

        .study-plan-tab:hover {
            background: #f7f6f3;
        }

        .study-plan-tab.active {
            background: #16a34a;
            color: #fff;
        }

        .sp-subject-selector {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-bottom: 20px;
        }

        .sp-subject-pill {
            padding: 6px 14px;
            border: 1px solid #d1d5db;
            border-radius: 20px;
            background: #fff;
            font-size: 12px;
            font-weight: 500;
            color: #37352f;
            cursor: pointer;
            font-family: inherit;
            transition: all 0.15s;
            white-space: nowrap;
        }

        .sp-subject-pill:hover {
            border-color: #16a34a;
            background: #f0fdf4;
        }

        .sp-subject-pill.active {
            background: #16a34a;
            color: #fff;
            border-color: #16a34a;
        }

        .sp-plan-wrapper {
            overflow-x: auto;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            background: #fff;
        }

        .sp-plan-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 700px;
        }

        .sp-plan-table thead th {
            background: #f7f6f3;
            font-size: 11px;
            font-weight: 600;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.4px;
            padding: 10px 12px;
            text-align: left;
            border-bottom: 1px solid #e9e9e7;
            white-space: nowrap;
            position: sticky;
            top: 0;
        }

        .sp-plan-table thead th:first-child {
            position: sticky;
            left: 0;
            z-index: 2;
            min-width: 150px;
        }

        .sp-plan-table thead th.sp-month-head {
            text-align: center;
            min-width: 100px;
        }

        .sp-plan-table tbody tr {
            border-bottom: 1px solid #f0f0ee;
            transition: background 0.1s;
        }

        .sp-plan-table tbody tr:last-child {
            border-bottom: none;
        }

        .sp-plan-table tbody tr:hover {
            background: #fafafa;
        }

        .sp-row-label {
            position: sticky;
            left: 0;
            background: #fff;
            z-index: 1;
            padding: 10px 12px;
            font-size: 13px;
            font-weight: 600;
            color: #37352f;
            border-right: 1px solid #e9e9e7;
            white-space: nowrap;
        }

        .sp-plan-table tbody tr:hover .sp-row-label {
            background: #fafafa;
        }

        .sp-cell {
            padding: 8px;
            text-align: center;
            vertical-align: middle;
            border-right: 1px solid #f0f0ee;
            min-width: 100px;
        }

        .sp-cell:last-child {
            border-right: none;
        }

        .sp-chapter-pills {
            display: flex;
            flex-wrap: wrap;
            gap: 4px;
            justify-content: center;
        }

        .sp-chapter-pill {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            min-width: 26px;
            height: 26px;
            padding: 0 6px;
            border-radius: 5px;
            font-size: 11px;
            font-weight: 600;
            background: #e8f5e9;
            color: #2e7d32;
            border: 1px solid #a5d6a7;
            cursor: default;
            white-space: nowrap;
        }

        .sp-chapter-pill.done {
            background: #bbdefb;
            color: #1565c0;
            border-color: #90caf9;
            text-decoration: line-through;
            opacity: 0.7;
        }

        .sp-time-row .sp-cell {
            background: #fefce8;
        }

        .sp-time-input {
            width: 70px;
            padding: 4px 6px;
            border: 1px solid #e9e9e7;
            border-radius: 4px;
            font-size: 12px;
            font-weight: 500;
            text-align: center;
            color: #37352f;
            font-family: inherit;
            background: #fff;
            transition: border-color 0.15s;
        }

        .sp-time-input:focus {
            outline: none;
            border-color: #16a34a;
            box-shadow: 0 0 0 2px rgba(22,163,74,0.15);
        }

        .sp-time-label {
            font-size: 10px;
            color: #9b9a97;
            margin-top: 2px;
        }

        .sp-summary-bar {
            display: flex;
            gap: 12px;
            margin-top: 16px;
            flex-wrap: wrap;
        }

        .sp-summary-card {
            flex: 1;
            min-width: 140px;
            background: #fff;
            border: 1px solid #e9e9e7;
            border-radius: 6px;
            padding: 12px 16px;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sp-summary-icon {
            width: 36px;
            height: 36px;
            border-radius: 8px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 18px;
            flex-shrink: 0;
        }

        .sp-summary-icon.green { background: #dcfce7; }
        .sp-summary-icon.blue  { background: #dbeafe; }
        .sp-summary-icon.amber { background: #fef3c7; }
        .sp-summary-icon.red   { background: #fee2e2; }

        .sp-summary-text .sp-sum-val {
            font-size: 20px;
            font-weight: 700;
            color: #37352f;
            line-height: 1.2;
        }

        .sp-summary-text .sp-sum-label {
            font-size: 11px;
            color: #9b9a97;
        }

        .sp-modal-overlay {
            display: none;
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.35);
            z-index: 500;
            align-items: center;
            justify-content: center;
        }

        .sp-modal-overlay.visible {
            display: flex;
        }

        .sp-modal {
            background: #fff;
            border-radius: 8px;
            width: 420px;
            max-width: 90vw;
            box-shadow: 0 16px 40px rgba(0,0,0,0.15);
            padding: 24px;
            animation: sp-modal-in 0.18s ease;
        }

        @keyframes sp-modal-in {
            from { opacity:0; transform: translateY(12px); }
            to   { opacity:1; transform: translateY(0); }
        }

        .sp-modal h3 {
            font-size: 17px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 4px;
        }

        .sp-modal .sp-modal-sub {
            font-size: 13px;
            color: #9b9a97;
            margin-bottom: 18px;
        }

        .sp-modal label {
            display: block;
            font-size: 12px;
            font-weight: 600;
            color: #78716c;
            margin-bottom: 5px;
            margin-top: 12px;
        }

        .sp-modal select,
        .sp-modal input[type="text"],
        .sp-modal input[type="number"] {
            width: 100%;
            padding: 8px 10px;
            border: 1px solid #e9e9e7;
            border-radius: 5px;
            font-size: 13px;
            font-family: inherit;
            color: #37352f;
            background: #fff;
            transition: border-color 0.15s;
        }

        .sp-modal select:focus,
        .sp-modal input:focus {
            outline: none;
            border-color: #16a34a;
            box-shadow: 0 0 0 2px rgba(22,163,74,0.12);
        }

        .sp-modal-actions {
            display: flex;
            justify-content: flex-end;
            gap: 8px;
            margin-top: 22px;
        }

        .sp-btn-cancel {
            padding: 7px 16px;
            border: 1px solid #e9e9e7;
            border-radius: 5px;
            background: #fff;
            color: #37352f;
            font-size: 13px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
        }

        .sp-btn-cancel:hover { background: #f7f6f3; }

        .sp-btn-save {
            padding: 7px 18px;
            border: none;
            border-radius: 5px;
            background: #16a34a;
            color: #fff;
            font-size: 13px;
            font-weight: 600;
            cursor: pointer;
            font-family: inherit;
            transition: background 0.15s;
        }

        .sp-btn-save:hover { background: #15803d; }
        /* ===== END STUDY PLAN ===== */

        .academic-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 20px;
        }

        .academic-title {
            font-size: 20px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 4px;
        }

        .academic-subtitle {
            font-size: 13px;
            color: #78716c;
        }

        .academic-badge {
            background: #fde047;
            padding: 4px 12px;
            border-radius: 3px;
            font-size: 12px;
            font-weight: 600;
            color: #854d0e;
        }

        .subjects-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 16px;
        }

        .subject-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 16px;
            transition: all 0.15s;
        }

        .subject-card:hover {
            box-shadow: 0 2px 8px rgba(0,0,0,0.05);
        }

        .subject-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            margin-bottom: 12px;
        }

        .subject-name {
            font-size: 15px;
            font-weight: 600;
            color: #37352f;
            flex: 1;
        }

        .year-badge {
            background: #e3e2e0;
            padding: 2px 8px;
            border-radius: 3px;
            font-size: 11px;
            font-weight: 600;
            color: #37352f;
        }

        .subject-progress {
            margin-bottom: 12px;
        }

        .progress-bar {
            height: 6px;
            background: #e9e9e7;
            border-radius: 3px;
            overflow: hidden;
            margin-bottom: 6px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #10b981, #059669);
            transition: width 0.3s;
        }

        .progress-text {
            display: flex;
            justify-content: space-between;
            font-size: 12px;
            color: #9b9a97;
        }

        .chapters-grid {
            display: grid;
            grid-template-columns: repeat(6, 1fr);
            gap: 4px;
            margin-bottom: 12px;
        }

        .chapter-box {
            aspect-ratio: 1;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 11px;
            font-weight: 600;
            transition: all 0.15s;
            background: #ffffff;
        }

        .chapter-box:hover {
            background: #f7f6f3;
        }

        .chapter-box.completed {
            background: #d1fae5;
            border-color: #10b981;
            color: #065f46;
        }

        .subject-meta {
            display: flex;
            justify-content: space-between;
            padding-top: 12px;
            border-top: 1px solid #e9e9e7;
            font-size: 12px;
        }

        .meta-item {
            display: flex;
            flex-direction: column;
            gap: 2px;
        }

        .meta-label {
            color: #9b9a97;
            font-size: 10px;
            text-transform: uppercase;
        }

        .meta-value {
            color: #37352f;
            font-weight: 600;
        }

        .deadline-warning {
            color: #dc2626;
        }

        .deadline-good {
            color: #059669;
        }

        /* Protocols */
        .protocols-list {
            display: flex;
            flex-direction: column;
            gap: 4px;
        }

        .protocol-item {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 3px;
            transition: background 0.15s;
        }

        .protocol-item:hover {
            background: #f7f6f3;
        }

        .protocol-number {
            font-size: 13px;
            color: #9b9a97;
            min-width: 24px;
        }

        .protocol-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            font-size: 14px;
            padding: 4px 0;
            font-family: inherit;
        }

        .protocol-input:focus {
            outline: none;
            background: #ffffff;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 3px;
        }

        .protocol-input::placeholder {
            color: #9b9a97;
        }

        /* Habit Table */
        .habit-table-container {
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            overflow: hidden;
            background: #ffffff;
        }

        .habit-table-scroll {
            overflow-x: auto;
        }

        .habit-table {
            width: 100%;
            border-collapse: collapse;
            min-width: 800px;
        }

        .habit-table th {
            background: #f7f6f3;
            color: #9b9a97;
            font-size: 11px;
            font-weight: 600;
            padding: 8px;
            text-align: center;
            border-bottom: 1px solid #e9e9e7;
            border-right: 1px solid #e9e9e7;
            position: sticky;
            top: 0;
            z-index: 10;
        }

        .habit-table th:first-child {
            text-align: left;
            min-width: 180px;
            position: sticky;
            left: 0;
            z-index: 11;
            background: #f7f6f3;
        }

        .habit-table th:last-child {
            border-right: none;
        }

        .habit-table th.today {
            background: #2383e2;
            color: #ffffff;
        }

        .habit-table td {
            border-bottom: 1px solid #e9e9e7;
            border-right: 1px solid #e9e9e7;
            padding: 0;
        }

        .habit-table td:last-child {
            border-right: none;
        }

        .habit-table tr:last-child td {
            border-bottom: none;
        }

        .habit-name-cell {
            position: sticky;
            left: 0;
            background: #ffffff;
            z-index: 9;
        }

        .habit-name-input {
            width: 100%;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 10px 12px;
            font-size: 14px;
            font-family: inherit;
        }

        .habit-name-input:focus {
            outline: none;
            background: #f7f6f3;
        }

        .habit-cell {
            width: 36px;
            height: 36px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 16px;
            transition: all 0.15s;
            background: #ffffff;
            user-select: none;
        }

        .habit-cell:hover {
            background: #f7f6f3;
        }

        .habit-cell.completed {
            background: #e7f5ec;
            color: #0f7b6c;
        }

        .habit-cell.failed {
            background: #ffe2dd;
            color: #eb5757;
        }

        .success-rate {
            font-size: 13px;
            font-weight: 500;
            text-align: center;
            padding: 10px 12px;
            color: #0f7b6c;
        }

        /* Two Column Layout */
        .two-column {
            display: grid;
            grid-template-columns: 1fr 400px;
            gap: 24px;
            margin-bottom: 32px;
        }

        @media (max-width: 1024px) {
            .two-column {
                grid-template-columns: 1fr;
            }
        }

        /* Goals */
        .goals-list {
            display: flex;
            flex-direction: column;
            gap: 16px;
        }

        .goal-item {
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 12px;
            background: #ffffff;
            transition: box-shadow 0.15s;
        }

        .goal-item:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .goal-header {
            display: flex;
            align-items: center;
            gap: 8px;
            margin-bottom: 12px;
        }

        .goal-number {
            background: #f7f6f3;
            color: #37352f;
            width: 22px;
            height: 22px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 600;
            font-size: 12px;
            border-radius: 3px;
            flex-shrink: 0;
        }

        .goal-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 4px 0;
            font-weight: 500;
            font-size: 14px;
            font-family: inherit;
        }

        .goal-input:focus {
            outline: none;
            background: #f7f6f3;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 3px;
        }

        .goal-input::placeholder {
            color: #9b9a97;
            font-weight: 400;
        }

        .goal-steps {
            display: flex;
            flex-direction: column;
            gap: 6px;
            padding-left: 30px;
        }

        .goal-step {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .step-checkbox {
            width: 16px;
            height: 16px;
            border: 1.5px solid #d3d3d1;
            border-radius: 3px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: all 0.15s;
        }

        .step-checkbox:hover {
            background: #f7f6f3;
        }

        .step-checkbox.checked {
            background: #2383e2;
            border-color: #2383e2;
            color: #ffffff;
        }

        .step-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 4px 0;
            font-size: 13px;
            font-family: inherit;
        }

        .step-input:focus {
            outline: none;
            background: #f7f6f3;
            padding: 4px 8px;
            margin: -4px -8px;
            border-radius: 3px;
        }

        .step-input::placeholder {
            color: #9b9a97;
        }

        /* Achievements */
        .achievements-list {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .achievement-item {
            display: flex;
            align-items: start;
            gap: 8px;
            padding: 6px 8px;
            border-radius: 3px;
            transition: background 0.15s;
        }

        .achievement-item:hover {
            background: #f7f6f3;
        }

        .achievement-bullet {
            color: #9b9a97;
            font-weight: 600;
            font-size: 16px;
            line-height: 1.5;
        }

        .achievement-input {
            flex: 1;
            background: transparent;
            border: none;
            color: #37352f;
            padding: 2px 0;
            font-size: 14px;
            font-family: inherit;
        }

        .achievement-input:focus {
            outline: none;
        }

        .achievement-input::placeholder {
            color: #9b9a97;
        }

        /* Notes */
        .notes-textarea {
            width: 100%;
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            color: #37352f;
            padding: 12px;
            font-size: 14px;
            min-height: 200px;
            resize: vertical;
            font-family: inherit;
            line-height: 1.6;
        }

        .notes-textarea:focus {
            outline: none;
            border-color: #2383e2;
            box-shadow: 0 0 0 1px #2383e2;
        }

        .notes-textarea::placeholder {
            color: #9b9a97;
        }

        /* Weekly View */
        .week-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 20px;
            margin-bottom: 16px;
            transition: box-shadow 0.15s;
        }

        .week-card:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .week-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 16px;
            border-bottom: 1px solid #e9e9e7;
        }

        .week-title {
            font-weight: 600;
            font-size: 18px;
            color: #37352f;
        }

        .week-dates {
            font-size: 13px;
            color: #9b9a97;
        }

        .week-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(120px, 1fr));
            gap: 12px;
        }

        .week-stat {
            text-align: center;
            padding: 16px;
            background: #f7f6f3;
            border-radius: 3px;
        }

        .week-stat-value {
            font-size: 28px;
            font-weight: 600;
            color: #37352f;
            line-height: 1;
            margin-bottom: 4px;
        }

        .week-stat-label {
            font-size: 11px;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Yearly View */
        .year-header {
            text-align: center;
            margin-bottom: 48px;
        }

        .year-title {
            font-size: 56px;
            font-weight: 700;
            color: #37352f;
            margin-bottom: 8px;
        }

        .year-subtitle {
            color: #9b9a97;
            font-size: 16px;
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 16px;
            margin-bottom: 48px;
        }

        .stat-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 24px;
            text-align: center;
            transition: box-shadow 0.15s;
        }

        .stat-card:hover {
            box-shadow: 0 1px 3px rgba(0, 0, 0, 0.05);
        }

        .stat-value {
            font-size: 48px;
            font-weight: 700;
            color: #37352f;
            line-height: 1;
            margin-bottom: 8px;
        }

        .stat-label {
            font-size: 11px;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            font-weight: 500;
        }

        .months-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 16px;
        }

        .month-card {
            background: #ffffff;
            border: 1px solid #e9e9e7;
            border-radius: 3px;
            padding: 20px;
            cursor: pointer;
            transition: all 0.15s;
        }

        .month-card:hover {
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.08);
            transform: translateY(-2px);
        }

        .month-card-title {
            font-size: 20px;
            font-weight: 600;
            margin-bottom: 16px;
            color: #37352f;
        }

        .month-card-stats {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
        }

        .month-stat {
            background: #f7f6f3;
            padding: 12px;
            border-radius: 3px;
        }

        .month-stat-value {
            font-size: 24px;
            font-weight: 600;
            color: #37352f;
            line-height: 1;
            margin-bottom: 4px;
        }

        .month-stat-label {
            font-size: 10px;
            color: #9b9a97;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: #d3d3d1;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #9b9a97;
        }
    </style>
</head>
<body>
    <!-- Sidebar -->
    <div class="sidebar">
        <div class="sidebar-header">
            <div class="sidebar-title">ðŸ“Š Momentum</div>
        </div>
        
        <div class="sidebar-nav" id="sidebarNav">
            <!-- Navigation items will be inserted here -->
        </div>
        
        <div class="month-selector" id="monthSelector">
            <!-- Month selector will be inserted here -->
        </div>
    </div>

    <!-- Mobile Navigation -->
    <div class="mobile-nav">
        <div class="mobile-nav-items" id="mobileNav">
            <!-- Mobile nav items will be inserted here -->
        </div>
    </div>

    <!-- Main Content -->
    <div class="main-content" id="mainContent">
        <!-- Content will be inserted here -->
    </div>

    <!-- Study Plan Modal -->
    <div class="sp-modal-overlay" id="spModalOverlay">
        <div class="sp-modal">
            <h3 id="spModalTitle">Assign Chapters</h3>
            <p class="sp-modal-sub" id="spModalSub">Choose chapters and target period</p>

            <label>Subject</label>
            <select id="spModalSubject"></select>

            <label>Target Period</label>
            <select id="spModalPeriod"></select>

            <label>Chapters to assign</label>
            <div id="spModalChapters" style="display:flex;gap:6px;flex-wrap:wrap;margin-top:6px;"></div>

            <div class="sp-modal-actions">
                <button class="sp-btn-cancel" onclick="closeStudyPlanModal()">Cancel</button>
                <button class="sp-btn-save" onclick="saveStudyPlanModal()">Save</button>
            </div>
        </div>
    </div>

    <script>
        // Utility Functions
        function getDaysInMonth(year, month) {
            return new Date(year, month + 1, 0).getDate();
        }

        function getMonthName(monthIndex) {
            const months = ['January', 'February', 'March', 'April', 'May', 'June',
                          'July', 'August', 'September', 'October', 'November', 'December'];
            return months[monthIndex];
        }

        function getDayName(date) {
            const days = ['Sun', 'Mon', 'Tue', 'Wed', 'Thu', 'Fri', 'Sat'];
            return days[date.getDay()];
        }

        function initializeMonthData(year, month) {
            const daysInMonth = getDaysInMonth(year, month);
            return {
                year,
                month,
                protocols: Array(10).fill(''),
                habits: Array(12).fill(null).map((_, i) => ({
                    name: `Habit ${i + 1}`,
                    days: Array(daysInMonth).fill(null)
                })),
                goals: Array(5).fill(null).map(() => ({
                    title: '',
                    steps: Array(3).fill(null).map(() => ({ text: '', completed: false }))
                })),
                achievements: Array(10).fill(''),
                notes: ''
            };
        }

        function initializeAcademicData() {
            return {
                subjects: [
                    { name: 'Business Math', year: '2nd Year', chapters: Array(6).fill(false), examDate: '2026-09-01' },
                    { name: 'Business Statistics', year: '3rd Year', chapters: Array(6).fill(false), examDate: '2026-08-31' },
                    { name: 'Management Accounting', year: '3rd Year', chapters: Array(6).fill(false), examDate: '2026-08-31' },
                    { name: 'Taxation in Bangladesh', year: '3rd Year', chapters: Array(6).fill(false), examDate: '2026-08-31' },
                    { name: 'Financial Management', year: '4th Year', chapters: Array(6).fill(false), examDate: '2026-09-30' },
                    { name: 'Project Management', year: '4th Year', chapters: Array(6).fill(false), examDate: '2026-12-31' },
                    { name: 'Investment Management', year: '4th Year', chapters: Array(6).fill(false), examDate: '2026-12-31' }
                ]
            };
        }

        function initializeStudyPlans() {
            return {};
        }

        // App State
        let state = {
            view: 'monthly',
            selectedMonth: { year: new Date().getFullYear(), month: new Date().getMonth() },
            yearData: {},
            academicData: null,
            studyPlans: {},
            spView: 'monthly',
            spSelectedSubject: 0
        };

        let progressChart = null;
        let spModalContext = {};

        // Load data from localStorage
        function loadData() {
            const saved = localStorage.getItem('momentumTracker');
            if (saved) {
                state.yearData = JSON.parse(saved);
            } else {
                const year = new Date().getFullYear();
                for (let month = 0; month < 12; month++) {
                    state.yearData[`${year}-${month}`] = initializeMonthData(year, month);
                }
            }

            const academicSaved = localStorage.getItem('academicTracker');
            if (academicSaved) {
                state.academicData = JSON.parse(academicSaved);
            } else {
                state.academicData = initializeAcademicData();
            }

            const spSaved = localStorage.getItem('studyPlans');
            state.studyPlans = spSaved ? JSON.parse(spSaved) : initializeStudyPlans();
        }

        // Save data to localStorage
        function saveData() {
            localStorage.setItem('momentumTracker', JSON.stringify(state.yearData));
            localStorage.setItem('academicTracker', JSON.stringify(state.academicData));
            localStorage.setItem('studyPlans', JSON.stringify(state.studyPlans));
        }

        // Get current month data
        function getCurrentMonthData() {
            const key = `${state.selectedMonth.year}-${state.selectedMonth.month}`;
            if (!state.yearData[key]) {
                state.yearData[key] = initializeMonthData(state.selectedMonth.year, state.selectedMonth.month);
            }
            return state.yearData[key];
        }

        // Update month data
        function updateMonthData(updates) {
            const key = `${state.selectedMonth.year}-${state.selectedMonth.month}`;
            state.yearData[key] = { ...getCurrentMonthData(), ...updates };
            saveData();
            render();
        }

        // Change view
        function changeView(newView) {
            state.view = newView;
            render();
        }

        // Change month
        function changeMonth(direction) {
            let newMonth = state.selectedMonth.month + direction;
            let newYear = state.selectedMonth.year;
            
            if (newMonth > 11) {
                newMonth = 0;
                newYear++;
            } else if (newMonth < 0) {
                newMonth = 11;
                newYear--;
            }
            
            state.selectedMonth = { year: newYear, month: newMonth };
            render();
        }

        // Select specific month
        function selectMonth(year, month) {
            state.selectedMonth = { year, month };
            state.view = 'monthly';
            render();
        }

        // Toggle chapter completion
        function toggleChapter(subjectIndex, chapterIndex) {
            state.academicData.subjects[subjectIndex].chapters[chapterIndex] = 
                !state.academicData.subjects[subjectIndex].chapters[chapterIndex];
            saveData();
            render();
        }

        // â”€â”€â”€ Study Plan Helpers â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function getSubjectPlan(si) {
            if (!state.studyPlans[si]) state.studyPlans[si] = { months:{}, weeks:{} };
            return state.studyPlans[si];
        }

        function getISOWeek(date) {
            const d = new Date(Date.UTC(date.getFullYear(), date.getMonth(), date.getDate()));
            const dayNum = d.getUTCDay() || 7;
            d.setUTCDate(d.getUTCDate() + 4 - dayNum);
            const yearStart = new Date(Date.UTC(d.getUTCFullYear(), 0, 1));
            return Math.ceil((((d - yearStart) / 86400000) + 1) / 7);
        }

        function getWeeksForMonth(year, month) {
            const days = getDaysInMonth(year, month);
            const weeks = [];
            const seen = new Set();
            for (let d = 1; d <= days; d++) {
                const date = new Date(year, month, d);
                const wk = getISOWeek(date);
                const key = `${year}-W${wk}`;
                if (!seen.has(key)) { seen.add(key); weeks.push({ key, week: wk, year }); }
            }
            return weeks;
        }

        function openStudyPlanModal(subjectIndex, periodKey) {
            spModalContext = { subjectIndex, periodKey };
            const subj = state.academicData.subjects[subjectIndex];
            const plan = getSubjectPlan(subjectIndex);
            const existing = (state.spView === 'monthly'
                ? (plan.months[periodKey] || {})
                : (plan.weeks[periodKey] || {}));

            const sSelect = document.getElementById('spModalSubject');
            sSelect.innerHTML = state.academicData.subjects.map((s,i) =>
                `<option value="${i}" ${i===subjectIndex?'selected':''}>${s.name}</option>`
            ).join('');
            sSelect.disabled = true;

            const pSelect = document.getElementById('spModalPeriod');
            pSelect.innerHTML = `<option value="${periodKey}" selected>${periodKey.replace('W',' W')}</option>`;
            pSelect.disabled = true;

            const chDiv = document.getElementById('spModalChapters');
            chDiv.innerHTML = '';
            for (let c = 1; c <= 6; c++) {
                const checked = existing.chapters && existing.chapters.includes(c);
                const done = subj.chapters[c-1];
                chDiv.innerHTML += `
                    <label style="display:inline-flex;align-items:center;gap:5px;padding:5px 10px;
                        border:1px solid ${done?'#a5d6a7':'#e9e9e7'};border-radius:5px;
                        background:${done?'#e8f5e9':'#fff'};cursor:pointer;font-size:12px;user-select:none;"
                    >
                        <input type="checkbox" data-ch="${c}" ${checked?'checked':''} ${done?'disabled':''} style="accent-color:#16a34a;">
                        Ch ${c} ${done?'âœ“':''}
                    </label>`;
            }

            document.getElementById('spModalTitle').textContent = `Plan: ${subj.name}`;
            document.getElementById('spModalSub').textContent = `Assign chapters for ${periodKey.replace('W',' Week ')}`;
            document.getElementById('spModalOverlay').classList.add('visible');
        }

        function closeStudyPlanModal() {
            document.getElementById('spModalOverlay').classList.remove('visible');
            spModalContext = {};
        }

        function saveStudyPlanModal() {
            const { subjectIndex, periodKey } = spModalContext;
            const plan = getSubjectPlan(subjectIndex);
            const store = state.spView === 'monthly' ? plan.months : plan.weeks;

            const chapters = [];
            document.querySelectorAll('#spModalChapters input[type=checkbox]').forEach(cb => {
                if (cb.checked) chapters.push(parseInt(cb.dataset.ch));
            });

            if (!store[periodKey]) store[periodKey] = { chapters:[], hours:'' };
            store[periodKey].chapters = chapters;

            saveData();
            closeStudyPlanModal();
            render();
        }

        function updateTimeAllocation(subjectIndex, periodKey, value) {
            const plan = getSubjectPlan(subjectIndex);
            const store = state.spView === 'monthly' ? plan.months : plan.weeks;
            if (!store[periodKey]) store[periodKey] = { chapters:[], hours:'' };
            store[periodKey].hours = value;
            saveData();
        }

        // Render Progress Chart
        function renderProgressChart() {
            const monthData = getCurrentMonthData();
            const daysInMonth = getDaysInMonth(state.selectedMonth.year, state.selectedMonth.month);
            
            // Calculate daily completion rates
            const dailyData = [];
            for (let day = 0; day < daysInMonth; day++) {
                let completed = 0;
                let failed = 0;
                let total = 0;
                
                monthData.habits.forEach(habit => {
                    if (habit.days[day] === 'completed') {
                        completed++;
                        total++;
                    } else if (habit.days[day] === 'failed') {
                        failed++;
                        total++;
                    }
                });
                
                dailyData.push({ completed, failed, total });
            }

            const totalCompleted = dailyData.reduce((sum, d) => sum + d.completed, 0);
            const totalFailed = dailyData.reduce((sum, d) => sum + d.failed, 0);

            let html = `
                <div class="chart-section">
                    <div class="chart-header">
                        <div class="chart-title">ðŸ“ˆ Your Progress Flow</div>
                        <div class="chart-stats">
                            <div class="chart-stat">
                                <div class="stat-dot completed"></div>
                                <span>${totalCompleted} Completed</span>
                            </div>
                            <div class="chart-stat">
                                <div class="stat-dot failed"></div>
                                <span>${totalFailed} Failed</span>
                            </div>
                        </div>
                    </div>
                    <div class="chart-container">
                        <canvas id="progressChart"></canvas>
                    </div>
                </div>
            `;

            return { html, dailyData };
        }

        function createChart(dailyData) {
            const ctx = document.getElementById('progressChart');
            if (!ctx) return;

            if (progressChart) {
                progressChart.destroy();
            }

            const labels = dailyData.map((_, i) => i + 1);
            const completedData = dailyData.map(d => d.completed);
            const failedData = dailyData.map(d => d.failed);

            progressChart = new Chart(ctx, {
                type: 'line',
                data: {
                    labels: labels,
                    datasets: [
                        {
                            label: 'Completed',
                            data: completedData,
                            borderColor: '#10b981',
                            backgroundColor: 'rgba(16, 185, 129, 0.1)',
                            tension: 0.4,
                            fill: true
                        },
                        {
                            label: 'Failed',
                            data: failedData,
                            borderColor: '#ef4444',
                            backgroundColor: 'rgba(239, 68, 68, 0.1)',
                            tension: 0.4,
                            fill: true
                        }
                    ]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    plugins: {
                        legend: {
                            display: false
                        },
                        tooltip: {
                            mode: 'index',
                            intersect: false
                        }
                    },
                    scales: {
                        y: {
                            beginAtZero: true,
                            ticks: {
                                stepSize: 1
                            },
                            grid: {
                                color: '#e9e9e7'
                            }
                        },
                        x: {
                            grid: {
                                display: false
                            }
                        }
                    }
                }
            });
        }

        // Render Academic Tracker
        function renderAcademicTracker() {
            const today = new Date();
            
            let html = `
                <div class="academic-section">
                    <div class="academic-header">
                        <div>
                            <div class="academic-title">ðŸŽ“ Academic Progress Tracker</div>
                            <div class="academic-subtitle">BBA Management â€¢ National University â€¢ 2021-22 Session</div>
                        </div>
                        <div class="academic-badge">4th Year</div>
                    </div>
                    <div class="subjects-grid">
            `;

            state.academicData.subjects.forEach((subject, subjectIndex) => {
                const completed = subject.chapters.filter(c => c).length;
                const progress = Math.round((completed / 6) * 100);
                const examDate = new Date(subject.examDate);
                const daysLeft = Math.ceil((examDate - today) / (1000 * 60 * 60 * 24));
                const weeksNeeded = Math.ceil((6 - completed));
                
                html += `
                    <div class="subject-card">
                        <div class="subject-header">
                            <div class="subject-name">${subject.name}</div>
                            <div class="year-badge">${subject.year}</div>
                        </div>
                        <div class="subject-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${progress}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${completed}/6 Chapters</span>
                                <span>${progress}%</span>
                            </div>
                        </div>
                        <div class="chapters-grid">
                `;

                subject.chapters.forEach((isCompleted, chapterIndex) => {
                    html += `
                        <div class="chapter-box ${isCompleted ? 'completed' : ''}" 
                             onclick="toggleChapter(${subjectIndex}, ${chapterIndex})">
                            ${chapterIndex + 1}
                        </div>
                    `;
                });

                const deadlineClass = daysLeft < 30 ? 'deadline-warning' : 'deadline-good';

                html += `
                        </div>
                        <div class="subject-meta">
                            <div class="meta-item">
                                <div class="meta-label">Exam Date</div>
                                <div class="meta-value">${examDate.toLocaleDateString('en-US', { month: 'short', day: 'numeric' })}</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Days Left</div>
                                <div class="meta-value ${deadlineClass}">${daysLeft}d</div>
                            </div>
                            <div class="meta-item">
                                <div class="meta-label">Weeks Needed</div>
                                <div class="meta-value">${weeksNeeded}w</div>
                            </div>
                        </div>
                    </div>
                `;
            });

            html += '</div></div>';
            return html;
        }

        // â”€â”€â”€ Render: Study Plan Section â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€
        function renderStudyPlan() {
            const si = state.spSelectedSubject;
            const subj = state.academicData.subjects[si];
            const plan = getSubjectPlan(si);
            const year = new Date().getFullYear();

            let pillsHtml = '';
            state.academicData.subjects.forEach((s, i) => {
                pillsHtml += `<button class="sp-subject-pill ${i===si?'active':''}"
                    onclick="state.spSelectedSubject=${i};render();">${s.name}</button>`;
            });

            const tabs = `<div class="study-plan-tabs">
                <button class="study-plan-tab ${state.spView==='monthly'?'active':''}"
                    onclick="state.spView='monthly';render();">Monthly</button>
                <button class="study-plan-tab ${state.spView==='weekly'?'active':''}"
                    onclick="state.spView='weekly';render();">Weekly</button>
            </div>`;

            let periods = [];
            if (state.spView === 'monthly') {
                for (let m = 1; m < 12; m++) {
                    periods.push({ key:`${year}-${String(m+1).padStart(2,'0')}`, label: getMonthName(m).substring(0, 3) });
                }
            } else {
                const allWeeks = new Map();
                for (let m = 1; m < 12; m++) {
                    getWeeksForMonth(year, m).forEach(w => {
                        if (!allWeeks.has(w.key)) allWeeks.set(w.key, w);
                    });
                }
                allWeeks.forEach(w => {
                    periods.push({ key: w.key, label: `W${w.week}` });
                });
            }

            let theadHtml = '<tr><th style="min-width:150px;position:sticky;left:0;z-index:2;background:#f7f6f3;">Chapter</th>';
            periods.forEach(p => { theadHtml += `<th class="sp-month-head">${p.label}</th>`; });
            theadHtml += '</tr>';

            let tbodyHtml = '';
            for (let ch = 1; ch <= 6; ch++) {
                const chDone = subj.chapters[ch-1];
                tbodyHtml += `<tr>
                    <td class="sp-row-label" style="${chDone?'color:#9b9a97;text-decoration:line-through;':''}"
                    >Chapter ${ch} ${chDone?'<span style="color:#16a34a;font-size:11px;">(done)</span>':''}</td>`;

                periods.forEach(p => {
                    const store = state.spView==='monthly' ? plan.months : plan.weeks;
                    const entry = store[p.key] || {};
                    const assigned = entry.chapters && entry.chapters.includes(ch);

                    if (assigned) {
                        tbodyHtml += `<td class="sp-cell" style="cursor:pointer;background:#e8f5e9;" onclick="openStudyPlanModal(${si},'${p.key}')">
                            <span class="sp-chapter-pill ${chDone?'done':''}">Ch ${ch}</span>
                        </td>`;
                    } else {
                        tbodyHtml += `<td class="sp-cell" style="cursor:pointer;" onclick="openStudyPlanModal(${si},'${p.key}')">
                            <span style="color:#ccc;font-size:14px;">+</span>
                        </td>`;
                    }
                });
                tbodyHtml += '</tr>';
            }

            tbodyHtml += `<tr class="sp-time-row">
                <td class="sp-row-label" style="background:#fefce8;font-weight:600;color:#854d0e;">â± Hours/week</td>`;
            periods.forEach(p => {
                const store = state.spView==='monthly' ? plan.months : plan.weeks;
                const entry = store[p.key] || {};
                tbodyHtml += `<td class="sp-cell" style="background:#fefce8;">
                    <input type="number" class="sp-time-input" placeholder="0"
                        value="${entry.hours||''}"
                        onchange="updateTimeAllocation(${si},'${p.key}',this.value)"
                        onblur="updateTimeAllocation(${si},'${p.key}',this.value)">
                    <div class="sp-time-label">${state.spView==='monthly'?'hrs/week':'hrs/wk'}</div>
                </td>`;
            });
            tbodyHtml += '</tr>';

            const totalPlanned = (() => {
                const allCh = new Set();
                const store = state.spView==='monthly' ? plan.months : plan.weeks;
                Object.values(store).forEach(e => (e.chapters||[]).forEach(c => allCh.add(c)));
                return allCh.size;
            })();
            const totalDone = subj.chapters.filter(c=>c).length;
            const totalHours = (() => {
                const store = state.spView==='monthly' ? plan.months : plan.weeks;
                return Object.values(store).reduce((s,e) => s + (parseFloat(e.hours)||0), 0);
            })();
            const unplanned = 6 - totalPlanned;

            let summaryHtml = `<div class="sp-summary-bar">
                <div class="sp-summary-card">
                    <div class="sp-summary-icon green">ðŸ“…</div>
                    <div class="sp-summary-text"><div class="sp-sum-val">${totalPlanned}</div><div class="sp-sum-label">Chapters Planned</div></div>
                </div>
                <div class="sp-summary-card">
                    <div class="sp-summary-icon blue">âœ…</div>
                    <div class="sp-summary-text"><div class="sp-sum-val">${totalDone}</div><div class="sp-sum-label">Chapters Done</div></div>
                </div>
                <div class="sp-summary-card">
                    <div class="sp-summary-icon amber">â±</div>
                    <div class="sp-summary-text"><div class="sp-sum-val">${totalHours}h</div><div class="sp-sum-label">Total Hours Set</div></div>
                </div>
                <div class="sp-summary-card">
                    <div class="sp-summary-icon ${unplanned>0?'red':'green'}">ðŸ“–</div>
                    <div class="sp-summary-text"><div class="sp-sum-val">${unplanned}</div><div class="sp-sum-label">Unplanned</div></div>
                </div>
            </div>`;

            return `<div class="study-plan-section">
                <div class="study-plan-header">
                    <div class="study-plan-header-left">
                        <h2>ðŸ“ Study Plan</h2>
                        <p>Set targets â€” assign chapters to specific weeks or months & allocate study hours</p>
                    </div>
                    ${tabs}
                </div>
                <div class="sp-subject-selector">${pillsHtml}</div>
                <div class="sp-plan-wrapper">
                    <table class="sp-plan-table">
                        <thead>${theadHtml}</thead>
                        <tbody>${tbodyHtml}</tbody>
                    </table>
                </div>
                ${summaryHtml}
            </div>`;
        }

        // Render Sidebar
        function renderSidebar() {
            const navItems = [
                { id: 'monthly', icon: 'ðŸ“…', label: 'Monthly Tracker' },
                { id: 'academics', icon: 'ðŸŽ“', label: 'Academic Tracker' },
                { id: 'weekly', icon: 'ðŸ“Š', label: 'Weekly Analysis' },
                { id: 'yearly', icon: 'ðŸ“ˆ', label: 'Yearly Overview' }
            ];

            let navHtml = '';
            navItems.forEach(item => {
                navHtml += `
                    <div class="nav-item ${state.view === item.id ? 'active' : ''}" 
                         onclick="changeView('${item.id}')">
                        <span class="nav-icon">${item.icon}</span>
                        ${item.label}
                    </div>
                `;
            });
            document.getElementById('sidebarNav').innerHTML = navHtml;

            // Month selector
            if (state.view === 'monthly') {
                document.getElementById('monthSelector').innerHTML = `
                    <div class="month-selector-title">Navigate</div>
                    <div class="month-controls">
                        <button onclick="changeMonth(-1)">â†</button>
                        <span class="month-name">
                            ${getMonthName(state.selectedMonth.month)} ${state.selectedMonth.year}
                        </span>
                        <button onclick="changeMonth(1)">â†’</button>
                    </div>
                `;
            } else {
                document.getElementById('monthSelector').innerHTML = '';
            }

            // Mobile nav
            let mobileNavHtml = '';
            navItems.forEach(item => {
                mobileNavHtml += `
                    <button class="mobile-nav-item ${state.view === item.id ? 'active' : ''}" 
                            onclick="changeView('${item.id}')">
                        ${item.icon}
                    </button>
                `;
            });
            document.getElementById('mobileNav').innerHTML = mobileNavHtml;
        }

        // Render Monthly View
        function renderMonthly() {
            const monthData = getCurrentMonthData();
            const daysInMonth = getDaysInMonth(state.selectedMonth.year, state.selectedMonth.month);
            const today = new Date();
            const isCurrentMonth = state.selectedMonth.year === today.getFullYear() && 
                                   state.selectedMonth.month === today.getMonth();
            
            let html = `
                <div class="page-header">
                    <h1 class="page-title">${getMonthName(state.selectedMonth.month)} ${state.selectedMonth.year}</h1>
                    <div class="page-subtitle">${daysInMonth} days to build momentum</div>
                    ${isCurrentMonth ? `<div class="today-badge">Today: ${getDayName(today)}, ${getMonthName(today.getMonth())} ${today.getDate()}</div>` : ''}
                </div>
            `;

            // Progress Chart
            const chartData = renderProgressChart();
            html += chartData.html;

            // Academic Tracker
            html += renderAcademicTracker();

            // Study Plan
            html += renderStudyPlan();

            // Two column layout
            html += '<div class="two-column">';
            
            // Left column
            html += '<div>';
            
            // Protocols
            html += `
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">ðŸ“‹</span>
                        <h2 class="section-title">Daily Protocols</h2>
                    </div>
                    <div class="protocols-list">
            `;
            
            monthData.protocols.forEach((protocol, i) => {
                html += `
                    <div class="protocol-item">
                        <div class="protocol-number">${i + 1}.</div>
                        <input 
                            type="text" 
                            class="protocol-input" 
                            value="${protocol}" 
                            onchange="updateProtocol(${i}, this.value)"
                            placeholder="What must you do every day?"
                        />
                    </div>
                `;
            });
            
            html += '</div></div>';
            html += '</div>'; // End left column

            // Right column
            html += '<div>';
            
            // Goals
            html += `
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">ðŸŽ¯</span>
                        <h2 class="section-title">Major Goals</h2>
                    </div>
                    <div class="goals-list">
            `;
            
            monthData.goals.forEach((goal, goalIndex) => {
                html += `
                    <div class="goal-item">
                        <div class="goal-header">
                            <div class="goal-number">${goalIndex + 1}</div>
                            <input 
                                type="text" 
                                class="goal-input" 
                                value="${goal.title}"
                                onchange="updateGoal(${goalIndex}, this.value)"
                                placeholder="What do you want to achieve?"
                            />
                        </div>
                        <div class="goal-steps">
                `;
                
                goal.steps.forEach((step, stepIndex) => {
                    html += `
                        <div class="goal-step">
                            <div class="step-checkbox ${step.completed ? 'checked' : ''}" 
                                 onclick="toggleStep(${goalIndex}, ${stepIndex})">
                                ${step.completed ? 'âœ“' : ''}
                            </div>
                            <input 
                                type="text" 
                                class="step-input" 
                                value="${step.text}"
                                onchange="updateStep(${goalIndex}, ${stepIndex}, this.value)"
                                placeholder="Action step..."
                            />
                        </div>
                    `;
                });
                
                html += '</div></div>';
            });
            
            html += '</div></div>';
            
            // Achievements
            html += `
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">ðŸ†</span>
                        <h2 class="section-title">Achievements</h2>
                    </div>
                    <div class="achievements-list">
            `;
            
            monthData.achievements.forEach((achievement, i) => {
                html += `
                    <div class="achievement-item">
                        <div class="achievement-bullet">â€¢</div>
                        <input 
                            type="text" 
                            class="achievement-input" 
                            value="${achievement}"
                            onchange="updateAchievement(${i}, this.value)"
                            placeholder="What did you accomplish?"
                        />
                    </div>
                `;
            });
            
            html += '</div></div>';
            
            // Notes
            html += `
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">ðŸ“</span>
                        <h2 class="section-title">Notes & Reflections</h2>
                    </div>
                    <textarea 
                        class="notes-textarea"
                        onchange="updateNotes(this.value)"
                        placeholder="Reflect on your month..."
                    >${monthData.notes}</textarea>
                </div>
            `;
            
            html += '</div>'; // End right column
            html += '</div>'; // End two-column

            // Habit Tracker (full width)
            html += `
                <div class="section">
                    <div class="section-header">
                        <span class="section-icon">âœ…</span>
                        <h2 class="section-title">Habit Tracker</h2>
                    </div>
                    <div class="habit-table-container">
                        <div class="habit-table-scroll">
                            <table class="habit-table">
                                <thead>
                                    <tr>
                                        <th>Habit</th>
            `;
            
            // Day headers
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(state.selectedMonth.year, state.selectedMonth.month, day);
                const isTodayClass = (isCurrentMonth && day === today.getDate()) ? 'today' : '';
                html += `<th class="${isTodayClass}"><div>${day}</div><div>${getDayName(date)}</div></th>`;
            }
            
            html += '<th>%</th></tr></thead><tbody>';
            
            // Habit rows
            monthData.habits.forEach((habit, habitIndex) => {
                const tracked = habit.days.filter(d => d !== null).length;
                const completed = habit.days.filter(d => d === 'completed').length;
                const successRate = tracked > 0 ? Math.round((completed / tracked) * 100) : 0;
                
                html += '<tr>';
                html += `
                    <td class="habit-name-cell">
                        <input 
                            type="text" 
                            class="habit-name-input" 
                            value="${habit.name}" 
                            onchange="updateHabitName(${habitIndex}, this.value)"
                        />
                    </td>
                `;
                
                habit.days.forEach((status, dayIndex) => {
                    const statusClass = status || '';
                    const symbol = status === 'completed' ? 'âœ“' : (status === 'failed' ? 'âœ—' : '');
                    html += `
                        <td>
                            <div class="habit-cell ${statusClass}" 
                                 onclick="toggleHabitDay(${habitIndex}, ${dayIndex})">${symbol}</div>
                        </td>
                    `;
                });
                
                html += `<td class="success-rate">${successRate}%</td></tr>`;
            });
            
            html += '</tbody></table></div></div></div>';
            
            return { html, chartData: chartData.dailyData };
        }

        // Render Academic View
        function renderAcademics() {
            let html = `
                <div class="page-header">
                    <h1 class="page-title">Academic Progress</h1>
                    <div class="page-subtitle">BBA Management â€¢ National University â€¢ Track your study goals</div>
                </div>
            `;

            html += renderAcademicTracker();
            html += renderStudyPlan();

            // Overall Statistics
            const totalChapters = state.academicData.subjects.length * 6;
            const completedChapters = state.academicData.subjects.reduce((sum, s) => 
                sum + s.chapters.filter(c => c).length, 0
            );
            const overallProgress = Math.round((completedChapters / totalChapters) * 100);
            const subjectsCompleted = state.academicData.subjects.filter(s => 
                s.chapters.every(c => c)
            ).length;

            html += `
                <div class="section" style="margin-top: 32px;">
                    <div class="section-header">
                        <span class="section-icon">ðŸ“Š</span>
                        <h2 class="section-title">Overall Statistics</h2>
                    </div>
                    <div class="stats-grid">
                        <div class="stat-card">
                            <div class="stat-value">${overallProgress}%</div>
                            <div class="stat-label">Overall Progress</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${completedChapters}</div>
                            <div class="stat-label">Chapters Done</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${totalChapters - completedChapters}</div>
                            <div class="stat-label">Chapters Left</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-value">${subjectsCompleted}</div>
                            <div class="stat-label">Subjects Done</div>
                        </div>
                    </div>
                </div>
            `;

            return html;
        }

        // Render Weekly View
        function renderWeekly() {
            const monthData = getCurrentMonthData();
            const daysInMonth = getDaysInMonth(state.selectedMonth.year, state.selectedMonth.month);
            
            let weeks = [];
            let currentWeek = [];
            
            for (let day = 1; day <= daysInMonth; day++) {
                const date = new Date(state.selectedMonth.year, state.selectedMonth.month, day);
                currentWeek.push({ day, dayOfWeek: date.getDay() });
                
                if (date.getDay() === 6 || day === daysInMonth) {
                    weeks.push([...currentWeek]);
                    currentWeek = [];
                }
            }
            
            let html = `
                <div class="page-header">
                    <h1 class="page-title">Weekly Breakdown</h1>
                    <div class="page-subtitle">${getMonthName(state.selectedMonth.month)} ${state.selectedMonth.year} â€¢ ${weeks.length} weeks</div>
                </div>
            `;
            
            weeks.forEach((week, weekIndex) => {
                const dayIndices = week.map(d => d.day - 1);
                let totalCompleted = 0;
                let totalFailed = 0;
                let totalTracked = 0;

                monthData.habits.forEach(habit => {
                    dayIndices.forEach(idx => {
                        if (habit.days[idx] === 'completed') totalCompleted++;
                        else if (habit.days[idx] === 'failed') totalFailed++;
                        if (habit.days[idx] !== null) totalTracked++;
                    });
                });

                const successRate = totalTracked > 0 ? Math.round((totalCompleted / totalTracked) * 100) : 0;
                const startDay = week[0].day;
                const endDay = week[week.length - 1].day;
                
                html += `
                    <div class="week-card">
                        <div class="week-header">
                            <div class="week-title">Week ${weekIndex + 1}</div>
                            <div class="week-dates">
                                ${getMonthName(state.selectedMonth.month)} ${startDay}-${endDay}
                            </div>
                        </div>
                        <div class="week-stats">
                            <div class="week-stat">
                                <div class="week-stat-value">${successRate}%</div>
                                <div class="week-stat-label">Success Rate</div>
                            </div>
                            <div class="week-stat">
                                <div class="week-stat-value">${totalCompleted}</div>
                                <div class="week-stat-label">Completed</div>
                            </div>
                            <div class="week-stat">
                                <div class="week-stat-value">${totalFailed}</div>
                                <div class="week-stat-label">Failed</div>
                            </div>
                            <div class="week-stat">
                                <div class="week-stat-value">${totalTracked}</div>
                                <div class="week-stat-label">Tracked</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            return html;
        }

        // Render Yearly View
        function renderYearly() {
            const currentYear = state.selectedMonth.year;
            let monthsData = [];
            
            for (let month = 0; month < 12; month++) {
                const key = `${currentYear}-${month}`;
                const data = state.yearData[key] || initializeMonthData(currentYear, month);
                
                let totalCompleted = 0;
                let totalFailed = 0;
                let totalTracked = 0;

                data.habits.forEach(habit => {
                    habit.days.forEach(status => {
                        if (status === 'completed') totalCompleted++;
                        else if (status === 'failed') totalFailed++;
                        if (status !== null) totalTracked++;
                    });
                });

                const successRate = totalTracked > 0 ? Math.round((totalCompleted / totalTracked) * 100) : 0;
                const goalsCompleted = data.goals.filter(g => 
                    g.title && g.steps.every(s => s.completed || s.text === '')
                ).length;

                monthsData.push({
                    month,
                    successRate,
                    totalCompleted,
                    totalTracked,
                    goalsCompleted
                });
            }
            
            // Calculate year stats
            const totalCompleted = monthsData.reduce((sum, m) => sum + m.totalCompleted, 0);
            const totalTracked = monthsData.reduce((sum, m) => sum + m.totalTracked, 0);
            const goalsCompleted = monthsData.reduce((sum, m) => sum + m.goalsCompleted, 0);
            const avgSuccess = Math.round(monthsData.reduce((sum, m) => sum + m.successRate, 0) / 12);
            
            let html = `
                <div class="year-header">
                    <h1 class="year-title">${currentYear}</h1>
                    <div class="year-subtitle">Your Year in Review</div>
                </div>
                
                <div class="stats-grid">
                    <div class="stat-card">
                        <div class="stat-value">${avgSuccess}%</div>
                        <div class="stat-label">Avg Success</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalCompleted}</div>
                        <div class="stat-label">Completed</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${totalTracked}</div>
                        <div class="stat-label">Tracked</div>
                    </div>
                    <div class="stat-card">
                        <div class="stat-value">${goalsCompleted}</div>
                        <div class="stat-label">Goals Done</div>
                    </div>
                </div>
                
                <div class="months-grid">
            `;
            
            monthsData.forEach(data => {
                html += `
                    <div class="month-card" onclick="selectMonth(${currentYear}, ${data.month})">
                        <div class="month-card-title">${getMonthName(data.month)}</div>
                        <div class="month-card-stats">
                            <div class="month-stat">
                                <div class="month-stat-value">${data.successRate}%</div>
                                <div class="month-stat-label">Success</div>
                            </div>
                            <div class="month-stat">
                                <div class="month-stat-value">${data.totalCompleted}</div>
                                <div class="month-stat-label">Completed</div>
                            </div>
                            <div class="month-stat">
                                <div class="month-stat-value">${data.totalTracked}</div>
                                <div class="month-stat-label">Tracked</div>
                            </div>
                            <div class="month-stat">
                                <div class="month-stat-value">${data.goalsCompleted}</div>
                                <div class="month-stat-label">Goals</div>
                            </div>
                        </div>
                    </div>
                `;
            });
            
            html += '</div>';
            return html;
        }

        // Update functions
        function updateProtocol(index, value) {
            const monthData = getCurrentMonthData();
            monthData.protocols[index] = value;
            updateMonthData({ protocols: monthData.protocols });
        }

        function updateHabitName(index, name) {
            const monthData = getCurrentMonthData();
            monthData.habits[index].name = name;
            updateMonthData({ habits: monthData.habits });
        }

        function toggleHabitDay(habitIndex, dayIndex) {
            const monthData = getCurrentMonthData();
            const currentState = monthData.habits[habitIndex].days[dayIndex];
            
            let newState = null;
            if (currentState === null) newState = 'completed';
            else if (currentState === 'completed') newState = 'failed';
            else newState = null;
            
            monthData.habits[habitIndex].days[dayIndex] = newState;
            updateMonthData({ habits: monthData.habits });
        }

        function updateGoal(index, value) {
            const monthData = getCurrentMonthData();
            monthData.goals[index].title = value;
            updateMonthData({ goals: monthData.goals });
        }

        function updateStep(goalIndex, stepIndex, value) {
            const monthData = getCurrentMonthData();
            monthData.goals[goalIndex].steps[stepIndex].text = value;
            updateMonthData({ goals: monthData.goals });
        }

        function toggleStep(goalIndex, stepIndex) {
            const monthData = getCurrentMonthData();
            monthData.goals[goalIndex].steps[stepIndex].completed = 
                !monthData.goals[goalIndex].steps[stepIndex].completed;
            updateMonthData({ goals: monthData.goals });
        }

        function updateAchievement(index, value) {
            const monthData = getCurrentMonthData();
            monthData.achievements[index] = value;
            updateMonthData({ achievements: monthData.achievements });
        }

        function updateNotes(value) {
            updateMonthData({ notes: value });
        }

        // Main render function
        function render() {
            renderSidebar();
            
            let content = '';
            let chartData = null;

            if (state.view === 'monthly') {
                const result = renderMonthly();
                content = result.html;
                chartData = result.chartData;
            } else if (state.view === 'academics') {
                content = renderAcademics();
            } else if (state.view === 'weekly') {
                content = renderWeekly();
            } else if (state.view === 'yearly') {
                content = renderYearly();
            }
            
            document.getElementById('mainContent').innerHTML = content;

            // Create chart after DOM is updated
            if (chartData) {
                setTimeout(() => createChart(chartData), 100);
            }
        }

        // Initialize app
        loadData();
        render();

        // Close modal on overlay click
        document.getElementById('spModalOverlay').addEventListener('click', function(e) {
            if (e.target === this) closeStudyPlanModal();
        });
    </script>
    
</body>
</html>